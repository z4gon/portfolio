<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Metal Render Pipeline Part 9: Draw Indexed Primitives</title><meta name="title" content="Metal Render Pipeline Part 9: Draw Indexed Primitives"/><meta name="description" content="Defining the indices array for the meshes, to remove duplicate vertices from the vertices array. Sending the indices array as an index buffer to the GPU, to describe how to render the primitive triangles."/><meta property="og:type" content="website"/><meta property="og:url" content="https://z4gon.github.io/blog/metal-render-pipeline-part-9-draw-indexed-primitives"/><meta property="og:title" content="Metal Render Pipeline Part 9: Draw Indexed Primitives"/><meta property="og:description" content="Defining the indices array for the meshes, to remove duplicate vertices from the vertices array. Sending the indices array as an index buffer to the GPU, to describe how to render the primitive triangles."/><meta property="og:image" content="https://z4gon.github.io/images/blog/metal-render-pipeline-part-9-draw-indexed-primitives/cover.jpg"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:url" content="https://z4gon.github.io/blog/metal-render-pipeline-part-9-draw-indexed-primitives"/><meta property="twitter:title" content="Metal Render Pipeline Part 9: Draw Indexed Primitives"/><meta property="twitter:description" content="Defining the indices array for the meshes, to remove duplicate vertices from the vertices array. Sending the indices array as an index buffer to the GPU, to describe how to render the primitive triangles."/><meta property="twitter:image" content="https://z4gon.github.io/images/blog/metal-render-pipeline-part-9-draw-indexed-primitives/cover.jpg"/><link rel="icon" href="https://z4gon.github.io/favicon.ico"/><link rel="canonical" href="https://z4gon.github.io/blog/metal-render-pipeline-part-9-draw-indexed-primitives"/><meta name="next-head-count" content="17"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/1bfb3b4d6930f464.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1bfb3b4d6930f464.css" data-n-g=""/><link rel="preload" href="/_next/static/css/7f11fd614ca16a3e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7f11fd614ca16a3e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-38cee4c0e358b1a3.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-f11614d8aa7ee555.js" defer=""></script><script src="/_next/static/chunks/pages/_app-a7128038526bd4a3.js" defer=""></script><script src="/_next/static/chunks/151-d7aafd1408876fb7.js" defer=""></script><script src="/_next/static/chunks/358-14c60bb94e9d94b9.js" defer=""></script><script src="/_next/static/chunks/895-5e9231f11f5aa57f.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-71753cea0aef4a44.js" defer=""></script><script src="/_next/static/dySdq6Xb0NnqayZdO7C_6/_buildManifest.js" defer=""></script><script src="/_next/static/dySdq6Xb0NnqayZdO7C_6/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,500;0,700;1,300;1,500&display=swap">@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memQYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWq8tWZ0Pw86hd0Rk5hkaVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memQYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWq8tWZ0Pw86hd0Rk_RkaVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsiH0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjr0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsg-1y4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtE6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWvU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWu06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWt06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuU6FxZCJgg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtE6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWvU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWu06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWt06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuU6FxZCJgg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="Page_page__0A7TG"><nav class="NavBar_navbar__W8B89"><ul class="NavBar_links__s6P8N"><li><a class="NavBar_titleLink__OtPh0" href="/"><h1>Gonzalo Cumini</h1></a></li><li class="NavBar_secondaryLink__TpgXh"><a href="/"><h1>Portfolio</h1></a></li><li class="NavBar_secondaryLink__TpgXh"><a href="/blog"><h1>Blog</h1></a></li></ul><ul class="NavBar_icons__Q_6kO"><li class="NavBar_icon__MjYq8"><a href="https://linkedin.com/in/gonzacn" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li><li class="NavBar_icon__MjYq8"><a href="https://github.com/z4gon" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li></ul></nav><main class="Container_container__B4HQR Container_narrow__Miio9"><div style="padding-top:3.5em"></div><article><div class="PostHeader_postHeader__aw96i"><h1 class="PostTitle_postTitle__oD_V4">Metal Render Pipeline Part 9: Draw Indexed Primitives</h1><div class="PostHeader_authorAndDate__tbJVE"><div class="Avatar_avatar__G9F0L"><img src="/images/avatars/z4gon.jpg" alt="Gonzalo Cumini"/><div class="Avatar_name__yGpBe">Gonzalo Cumini</div></div><time class="DateFormatter_dateFormatter__UBCZJ" dateTime="2022-12-28T01:00:00.000Z">December	28, 2022</time></div><div class="CoverImage_coverImage__lFFCh"><img src="/images/blog/metal-render-pipeline-part-9-draw-indexed-primitives/cover.jpg" alt="Cover Image for Metal Render Pipeline Part 9: Draw Indexed Primitives"/><a href="https://vulkan-tutorial.com/Vertex_buffers/Index_buffer" target="_blank" rel="noopener noreferrer">Image Source üîó</a></div></div><div class="MarkdownContent_markdownContent__TdwXL"><h2 id="source-code">Source Code</h2>
<p><a href="https://github.com/z4gon/metal-render-pipeline">See Project in GitHub üë©‚Äçüíª</a></p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.youtube.com/playlist?list=PLEXt1-oJUa4BVgjZt9tK2MhV_DW7PVDsg">Metal Render Pipeline tutorial series by Rick Twohy</a></li>
<li><a href="https://vulkan-tutorial.com/Vertex_buffers/Index_buffer">Index Buffer</a></li>
</ul>
<hr/>
<h2 id="table-of-content">Table of Content</h2>
<ul>
<li><a href="#mesh-indices">Mesh Indices</a></li>
<li><a href="#index-buffer">Index Buffer</a></li>
<li><a href="#draw-indexed-primitive">Draw Indexed Primitive</a></li>
</ul>
<hr/>
<h2 id="mesh-indices">Mesh Indices</h2>
<p>The <strong>Mesh</strong> now also sets an array of indices to go along the array of vertices.</p>
<p>This allows to eliminate duplicates and optimize memory utilization.</p>
<p><img src="/images/blog/metal-render-pipeline-part-9-draw-indexed-primitives/cover.jpg" alt="Picture"/></p>
<p><a href="https://vulkan-tutorial.com/Vertex_buffers/Index_buffer">Image Source üîó</a></p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">Mesh</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> vertices: [</span><span style="color:#880000">Vertex</span><span>]</span><span class="hljs-operator">!</span><span> </span><span class="hljs-operator">=</span><span> []
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> indices: [</span><span style="color:#880000">UInt32</span><span>]</span><span class="hljs-operator">!</span><span> </span><span class="hljs-operator">=</span><span> []
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>    </span><span class="hljs-function" style="font-weight:bold">init</span><span class="hljs-function">()</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span>        createMesh()
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>    </span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">createMesh</span><span class="hljs-function">()</span><span> {}
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>}</code></div></pre>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">QuadMesh</span><span class="hljs-class"> : </span><span class="hljs-class" style="color:#880000;font-weight:bold">Mesh</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>    </span><span style="font-weight:bold">override</span><span> </span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">createMesh</span><span class="hljs-function">()</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>        vertices </span><span class="hljs-operator">=</span><span> [
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>            </span><span style="color:#880000">Vertex</span><span>(position: float3( </span><span style="color:#880000">0.5</span><span>, </span><span style="color:#880000">0.5</span><span>,</span><span style="color:#880000">0</span><span>), color: float4(</span><span style="color:#880000">1</span><span>,</span><span style="color:#880000">0</span><span>,</span><span style="color:#880000">0</span><span>,</span><span style="color:#880000">1</span><span>)), </span><span style="color:#888888">//Top Right</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>            </span><span style="color:#880000">Vertex</span><span>(position: float3(</span><span class="hljs-operator">-</span><span style="color:#880000">0.5</span><span>, </span><span style="color:#880000">0.5</span><span>,</span><span style="color:#880000">0</span><span>), color: float4(</span><span style="color:#880000">0</span><span>,</span><span style="color:#880000">1</span><span>,</span><span style="color:#880000">0</span><span>,</span><span style="color:#880000">1</span><span>)), </span><span style="color:#888888">//Top Left</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>            </span><span style="color:#880000">Vertex</span><span>(position: float3(</span><span class="hljs-operator">-</span><span style="color:#880000">0.5</span><span>,</span><span class="hljs-operator">-</span><span style="color:#880000">0.5</span><span>,</span><span style="color:#880000">0</span><span>), color: float4(</span><span style="color:#880000">0</span><span>,</span><span style="color:#880000">0</span><span>,</span><span style="color:#880000">1</span><span>,</span><span style="color:#880000">1</span><span>)), </span><span style="color:#888888">//Bottom Left</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>            </span><span style="color:#880000">Vertex</span><span>(position: float3( </span><span style="color:#880000">0.5</span><span>,</span><span class="hljs-operator">-</span><span style="color:#880000">0.5</span><span>,</span><span style="color:#880000">0</span><span>), color: float4(</span><span style="color:#880000">1</span><span>,</span><span style="color:#880000">0</span><span>,</span><span style="color:#880000">1</span><span>,</span><span style="color:#880000">1</span><span>))  </span><span style="color:#888888">//Bottom Right</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span>        ]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span><span>        indices </span><span class="hljs-operator">=</span><span> [
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>            </span><span style="color:#880000">0</span><span>,</span><span style="color:#880000">1</span><span>,</span><span style="color:#880000">2</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span>            </span><span style="color:#880000">0</span><span>,</span><span style="color:#880000">2</span><span>,</span><span style="color:#880000">3</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>        ]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span>}</code></div></pre>
<hr/>
<h2 id="index-buffer">Index Buffer</h2>
<p>The <strong>Mesh Renderer</strong> will create another <strong>MTLBuffer</strong> to send these indexes to the <strong>GPU</strong>.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">MeshRenderer</span><span class="hljs-class"> : </span><span class="hljs-class" style="color:#880000;font-weight:bold">Component</span><span class="hljs-class">, </span><span class="hljs-class" style="color:#880000;font-weight:bold">Renderable</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span class="hljs-operator">...</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>    </span><span style="font-weight:bold">private</span><span> </span><span style="font-weight:bold">var</span><span> _vertexBuffer: </span><span style="color:#880000">MTLBuffer</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>    </span><span style="font-weight:bold">private</span><span> </span><span style="font-weight:bold">var</span><span> _indexBuffer: </span><span style="color:#880000">MTLBuffer</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span>    </span><span class="hljs-operator">...</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span><span>    </span><span class="hljs-function" style="font-weight:bold">init</span><span class="hljs-function">(</span><span class="hljs-function hljs-params">mesh</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">Mesh</span><span class="hljs-function">)</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>        _mesh </span><span class="hljs-operator">=</span><span> mesh
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span><span>        _vertexBuffer </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">Engine</span><span>.device.makeBuffer(bytes: _mesh.vertices, length: </span><span style="color:#880000">Vertex</span><span>.stride </span><span class="hljs-operator">*</span><span> _mesh.vertices.count, options: [])
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span><span>        </span><span style="font-weight:bold">if</span><span>(_mesh.indices.count </span><span class="hljs-operator">&gt;</span><span> </span><span style="color:#880000">0</span><span>){
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">16</span><span>            _indexBuffer </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">Engine</span><span>.device.makeBuffer(bytes: _mesh.indices, length: </span><span style="color:#880000">UInt32</span><span>.stride </span><span class="hljs-operator">*</span><span> _mesh.indices.count, options: [])
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">17</span>        }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">18</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">19</span>}</code></div></pre>
<hr/>
<h2 id="draw-indexed-primitive">Draw Indexed Primitive</h2>
<p>The <strong>Mesh Renderer</strong> will draw the primitives by sending the indices as instructions on how to interpret the vertices to draw the triangles.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">doRender</span><span class="hljs-function">(</span><span class="hljs-function hljs-params">renderCommandEncoder</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">MTLRenderCommandEncoder</span><span class="hljs-function">)</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span class="hljs-operator">...</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>    </span><span style="font-weight:bold">if</span><span>(_mesh.indices.count </span><span class="hljs-operator">&gt;</span><span> </span><span style="color:#880000">0</span><span>){
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span>        renderCommandEncoder.drawIndexedPrimitives(
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>            type: </span><span style="color:#880000">MTLPrimitiveType</span><span>.triangle,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span>            indexCount: _mesh.indices.count,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>            indexType: </span><span style="color:#880000">MTLIndexType</span><span>.uint32,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>            indexBuffer: _indexBuffer,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>            indexBufferOffset: </span><span style="color:#880000">0</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span>            instanceCount: </span><span style="color:#880000">1</span><span> </span><span style="color:#888888">// for now, might change in the future</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>        )
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span><span>    } </span><span style="font-weight:bold">else</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span>        renderCommandEncoder.drawPrimitives(
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">16</span><span>            type: </span><span style="color:#880000">MTLPrimitiveType</span><span>.triangle,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">17</span><span>            vertexStart: </span><span style="color:#880000">0</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">18</span>            vertexCount: _mesh.vertices.count
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">19</span>        )
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">20</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">21</span>}</code></div></pre></div></article><div style="padding-top:3.5em"></div></main><footer class="Footer_footer__rEL09"><p>¬©<!-- --> 2023, Gonzalo Cumini</p><ul class="Footer_icons__IyNdc"><li class="Footer_icon__mhtwE"><a href="https://linkedin.com/in/gonzacn" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li><li class="Footer_icon__mhtwE"><a href="https://github.com/z4gon" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li></ul></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"metal-render-pipeline-part-9-draw-indexed-primitives","date":"2022-12-28T01:00:00.000Z","author":{"name":"Gonzalo Cumini","pictureUrl":"/images/avatars/z4gon.jpg"},"title":"Metal Render Pipeline Part 9: Draw Indexed Primitives","excerpt":"Defining the indices array for the meshes, to remove duplicate vertices from the vertices array. Sending the indices array as an index buffer to the GPU, to describe how to render the primitive triangles.","coverImageUrl":"/images/blog/metal-render-pipeline-part-9-draw-indexed-primitives/cover.jpg","coverImageSourceUrl":"https://vulkan-tutorial.com/Vertex_buffers/Index_buffer","coverVideoUrl":"","markdownContent":"\n## Source Code\n\n[See Project in GitHub üë©‚Äçüíª](https://github.com/z4gon/metal-render-pipeline)\n\n## References\n\n- [Metal Render Pipeline tutorial series by Rick Twohy](https://www.youtube.com/playlist?list=PLEXt1-oJUa4BVgjZt9tK2MhV_DW7PVDsg)\n- [Index Buffer](https://vulkan-tutorial.com/Vertex_buffers/Index_buffer)\n\n---\n\n## Table of Content\n\n- [Mesh Indices](#mesh-indices)\n- [Index Buffer](#index-buffer)\n- [Draw Indexed Primitive](#draw-indexed-primitive)\n\n---\n\n## Mesh Indices\n\nThe **Mesh** now also sets an array of indices to go along the array of vertices.\n\nThis allows to eliminate duplicates and optimize memory utilization.\n\n![Picture](/images/blog/metal-render-pipeline-part-9-draw-indexed-primitives/cover.jpg)\n\n[Image Source üîó](https://vulkan-tutorial.com/Vertex_buffers/Index_buffer)\n\n```swift\nclass Mesh {\n    public var vertices: [Vertex]! = []\n    public var indices: [UInt32]! = []\n\n    init(){\n        createMesh()\n    }\n\n    func createMesh() {}\n}\n```\n\n```swift\nclass QuadMesh : Mesh{\n    override func createMesh() {\n        vertices = [\n            Vertex(position: float3( 0.5, 0.5,0), color: float4(1,0,0,1)), //Top Right\n            Vertex(position: float3(-0.5, 0.5,0), color: float4(0,1,0,1)), //Top Left\n            Vertex(position: float3(-0.5,-0.5,0), color: float4(0,0,1,1)), //Bottom Left\n            Vertex(position: float3( 0.5,-0.5,0), color: float4(1,0,1,1))  //Bottom Right\n        ]\n\n        indices = [\n            0,1,2,\n            0,2,3\n        ]\n    }\n}\n```\n\n---\n\n## Index Buffer\n\nThe **Mesh Renderer** will create another **MTLBuffer** to send these indexes to the **GPU**.\n\n```swift\nclass MeshRenderer : Component, Renderable {\n\n    ...\n\n    private var _vertexBuffer: MTLBuffer!\n    private var _indexBuffer: MTLBuffer!\n\n    ...\n\n    init(mesh: Mesh) {\n        _mesh = mesh\n\n        _vertexBuffer = Engine.device.makeBuffer(bytes: _mesh.vertices, length: Vertex.stride * _mesh.vertices.count, options: [])\n\n        if(_mesh.indices.count \u003e 0){\n            _indexBuffer = Engine.device.makeBuffer(bytes: _mesh.indices, length: UInt32.stride * _mesh.indices.count, options: [])\n        }\n    }\n}\n```\n\n---\n\n## Draw Indexed Primitive\n\nThe **Mesh Renderer** will draw the primitives by sending the indices as instructions on how to interpret the vertices to draw the triangles.\n\n```swift\nfunc doRender(renderCommandEncoder: MTLRenderCommandEncoder) {\n\n    ...\n\n    if(_mesh.indices.count \u003e 0){\n        renderCommandEncoder.drawIndexedPrimitives(\n            type: MTLPrimitiveType.triangle,\n            indexCount: _mesh.indices.count,\n            indexType: MTLIndexType.uint32,\n            indexBuffer: _indexBuffer,\n            indexBufferOffset: 0,\n            instanceCount: 1 // for now, might change in the future\n        )\n    } else {\n        renderCommandEncoder.drawPrimitives(\n            type: MTLPrimitiveType.triangle,\n            vertexStart: 0,\n            vertexCount: _mesh.vertices.count\n        )\n    }\n}\n```\n"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"metal-render-pipeline-part-9-draw-indexed-primitives"},"buildId":"dySdq6Xb0NnqayZdO7C_6","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>