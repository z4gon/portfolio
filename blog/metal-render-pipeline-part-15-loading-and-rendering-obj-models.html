<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Metal Render Pipeline Part 15: Loading and Rendering .OBJ Models</title><meta name="title" content="Metal Render Pipeline Part 15: Loading and Rendering .OBJ Models"/><meta name="description" content="Mesh References describing the .OBJ asset and how to load it. Mesh Loader to actually use ModelIO and load the MTKMeshes out of the .OBJ file, using a MTKModelIOVertexDescriptor. Extending the Mesh class to have two subclasses, the BuiltInMesh and the ModelMesh. The Model Mesh will have a reference to the MTKMesh with all the submeshes, vertex and index buffers. Modifying the Mesh Renderer to be able to render MTKMeshes. Using Texture References and Texture Loaders to load any needed texture for the models."/><meta property="og:type" content="website"/><meta property="og:url" content="https://z4gon.github.io/blog/metal-render-pipeline-part-15-loading-and-rendering-obj-models"/><meta property="og:title" content="Metal Render Pipeline Part 15: Loading and Rendering .OBJ Models"/><meta property="og:description" content="Mesh References describing the .OBJ asset and how to load it. Mesh Loader to actually use ModelIO and load the MTKMeshes out of the .OBJ file, using a MTKModelIOVertexDescriptor. Extending the Mesh class to have two subclasses, the BuiltInMesh and the ModelMesh. The Model Mesh will have a reference to the MTKMesh with all the submeshes, vertex and index buffers. Modifying the Mesh Renderer to be able to render MTKMeshes. Using Texture References and Texture Loaders to load any needed texture for the models."/><meta property="og:image" content="https://z4gon.github.io/images/blog/metal-render-pipeline-part-15-loading-and-rendering-obj-models/cover.jpg"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:url" content="https://z4gon.github.io/blog/metal-render-pipeline-part-15-loading-and-rendering-obj-models"/><meta property="twitter:title" content="Metal Render Pipeline Part 15: Loading and Rendering .OBJ Models"/><meta property="twitter:description" content="Mesh References describing the .OBJ asset and how to load it. Mesh Loader to actually use ModelIO and load the MTKMeshes out of the .OBJ file, using a MTKModelIOVertexDescriptor. Extending the Mesh class to have two subclasses, the BuiltInMesh and the ModelMesh. The Model Mesh will have a reference to the MTKMesh with all the submeshes, vertex and index buffers. Modifying the Mesh Renderer to be able to render MTKMeshes. Using Texture References and Texture Loaders to load any needed texture for the models."/><meta property="twitter:image" content="https://z4gon.github.io/images/blog/metal-render-pipeline-part-15-loading-and-rendering-obj-models/cover.jpg"/><link rel="icon" href="https://z4gon.github.io/favicon.ico"/><link rel="canonical" href="https://z4gon.github.io/blog/metal-render-pipeline-part-15-loading-and-rendering-obj-models"/><meta name="next-head-count" content="17"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/1bfb3b4d6930f464.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1bfb3b4d6930f464.css" data-n-g=""/><link rel="preload" href="/_next/static/css/7f11fd614ca16a3e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7f11fd614ca16a3e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-38cee4c0e358b1a3.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-f11614d8aa7ee555.js" defer=""></script><script src="/_next/static/chunks/pages/_app-a7128038526bd4a3.js" defer=""></script><script src="/_next/static/chunks/151-d7aafd1408876fb7.js" defer=""></script><script src="/_next/static/chunks/358-14c60bb94e9d94b9.js" defer=""></script><script src="/_next/static/chunks/895-5e9231f11f5aa57f.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-71753cea0aef4a44.js" defer=""></script><script src="/_next/static/dySdq6Xb0NnqayZdO7C_6/_buildManifest.js" defer=""></script><script src="/_next/static/dySdq6Xb0NnqayZdO7C_6/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,500;0,700;1,300;1,500&display=swap">@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memQYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWq8tWZ0Pw86hd0Rk5hkaVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memQYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWq8tWZ0Pw86hd0Rk_RkaVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsiH0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjr0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsg-1y4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtE6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWvU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWu06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWt06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuU6FxZCJgg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtE6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWvU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWu06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWt06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuU6FxZCJgg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="Page_page__0A7TG"><nav class="NavBar_navbar__W8B89"><ul class="NavBar_links__s6P8N"><li><a class="NavBar_titleLink__OtPh0" href="/"><h1>Gonzalo Cumini</h1></a></li><li class="NavBar_secondaryLink__TpgXh"><a href="/"><h1>Portfolio</h1></a></li><li class="NavBar_secondaryLink__TpgXh"><a href="/blog"><h1>Blog</h1></a></li></ul><ul class="NavBar_icons__Q_6kO"><li class="NavBar_icon__MjYq8"><a href="https://linkedin.com/in/gonzacn" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li><li class="NavBar_icon__MjYq8"><a href="https://github.com/z4gon" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li></ul></nav><main class="Container_container__B4HQR Container_narrow__Miio9"><div style="padding-top:3.5em"></div><article><div class="PostHeader_postHeader__aw96i"><h1 class="PostTitle_postTitle__oD_V4">Metal Render Pipeline Part 15: Loading and Rendering .OBJ Models</h1><div class="PostHeader_authorAndDate__tbJVE"><div class="Avatar_avatar__G9F0L"><img src="/images/avatars/z4gon.jpg" alt="Gonzalo Cumini"/><div class="Avatar_name__yGpBe">Gonzalo Cumini</div></div><time class="DateFormatter_dateFormatter__UBCZJ" dateTime="2023-01-02T00:00:00.000Z">January	2, 2023</time></div><video muted="" playsinline="" controls="" class="PostHeader_coverVideo__CTucm"><source src="/videos/blog/metal-render-pipeline-part-15-loading-and-rendering-obj-models/1.mp4" type="video/mp4"/></video></div><div class="MarkdownContent_markdownContent__TdwXL"><h2 id="source-code">Source Code</h2>
<p><a href="https://github.com/z4gon/metal-render-pipeline">See Project in GitHub üë©‚Äçüíª</a></p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.youtube.com/playlist?list=PLEXt1-oJUa4BVgjZt9tK2MhV_DW7PVDsg">Metal Render Pipeline tutorial series by Rick Twohy</a></li>
</ul>
<h2 id="table-of-content">Table of Content</h2>
<ul>
<li><a href="#model-mesh-reference">Model Mesh Reference</a></li>
<li><a href="#model-mesh-loader">Model Mesh Loader</a></li>
<li><a href="#mesh">Mesh</a></li>
<li><a href="#mesh-renderer">Mesh Renderer</a></li>
<li><a href="#textures">Textures</a></li>
<li><a href="#model-game-object">Model Game Object</a></li>
<li><a href="#result">Result</a></li>
</ul>
<hr/>
<h2 id="model-mesh-reference">Model Mesh Reference</h2>
<p>The <strong>Model Mesh Reference</strong> will point to the asset that we want to load from.</p>
<p>It will also have a <strong>load()</strong> method that will be in charge of initializing the actual <strong>Mesh</strong> object.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">protocol</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">MeshReference</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>    </span><span style="font-weight:bold">var</span><span> id: </span><span style="color:#880000">String</span><span>! { </span><span style="font-weight:bold">get</span><span> }
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">load</span><span class="hljs-function">()</span><span>-&gt;</span><span style="color:#880000">Mesh</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span>}
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span></span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">ModelMeshReference</span><span class="hljs-class"> : </span><span class="hljs-class" style="color:#880000;font-weight:bold">MeshReference</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> name: </span><span style="color:#880000">String</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> fileExtension: </span><span style="color:#880000">String</span><span>! </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">&quot;obj&quot;</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> meshIndex: </span><span style="color:#880000">Int</span><span> </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">0</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> id: </span><span style="color:#880000">String</span><span>! {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span>        </span><span style="font-weight:bold">return</span><span> </span><span style="color:#880000">&quot;</span><span style="color:#444">\(name</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">.</span><span style="color:#444">\(fileExtension</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">:</span><span style="color:#444">\(meshIndex)</span><span style="color:#880000">&quot;</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span><span>    </span><span class="hljs-function" style="font-weight:bold">init</span><span class="hljs-function">(
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class="hljs-function">        </span><span class="hljs-function" style="font-weight:bold">_</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">name</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">String</span><span class="hljs-function">,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class="hljs-function">        </span><span class="hljs-function hljs-params">fileExtension</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">String</span><span class="hljs-function"> </span><span class="hljs-function hljs-operator">=</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000">&quot;obj&quot;</span><span class="hljs-function">,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">18</span><span class="hljs-function">        </span><span class="hljs-function hljs-params">meshIndex</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">Int</span><span class="hljs-function"> </span><span class="hljs-function hljs-operator">=</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000">0</span><span class="hljs-function">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">19</span><span class="hljs-function">    )</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">20</span><span>        </span><span style="font-weight:bold">self</span><span>.name </span><span class="hljs-operator">=</span><span> name
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">21</span><span>        </span><span style="font-weight:bold">self</span><span>.fileExtension </span><span class="hljs-operator">=</span><span> fileExtension
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">22</span><span>        </span><span style="font-weight:bold">self</span><span>.meshIndex </span><span class="hljs-operator">=</span><span> meshIndex
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">23</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">24</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">25</span><span>    </span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">load</span><span class="hljs-function">()</span><span>-&gt;</span><span style="color:#880000">Mesh</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">26</span><span>        </span><span style="font-weight:bold">return</span><span> </span><span style="color:#880000">ModelMeshLoader</span><span>(</span><span style="font-weight:bold">self</span><span>).load()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">27</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">28</span>}</code></div></pre>
<p>This will act as an <strong>identifier</strong> when caching model meshes in the corresponding cache.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> id: </span><span style="color:#880000">String</span><span>! {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>        </span><span style="font-weight:bold">return</span><span> </span><span style="color:#880000">&quot;</span><span style="color:#444">\(name</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">.</span><span style="color:#444">\(fileExtension</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">:</span><span style="color:#444">\(meshIndex)</span><span style="color:#880000">&quot;</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span>    }</code></div></pre>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">MeshCache</span><span class="hljs-class"> : </span><span class="hljs-class" style="color:#880000;font-weight:bold">Cache</span><span class="hljs-class">&lt;</span><span class="hljs-class" style="color:#880000;font-weight:bold">MeshReference</span><span class="hljs-class">, </span><span class="hljs-class" style="color:#880000;font-weight:bold">Mesh</span><span class="hljs-class">&gt; </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span style="font-weight:bold">private</span><span> </span><span style="font-weight:bold">static</span><span> </span><span style="font-weight:bold">var</span><span> _meshes: [</span><span style="color:#880000">String</span><span>: </span><span style="color:#880000">Mesh</span><span>] </span><span class="hljs-operator">=</span><span> [:]
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>    </span><span style="font-weight:bold">override</span><span> </span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">func</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">get</span><span class="hljs-class">(</span><span class="hljs-class" style="color:#880000;font-weight:bold">_</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">meshReference</span><span class="hljs-class">: </span><span class="hljs-class" style="color:#880000;font-weight:bold">MeshReference</span><span class="hljs-class">)-&gt;</span><span class="hljs-class" style="color:#880000;font-weight:bold">Mesh</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>        </span><span style="font-weight:bold">if</span><span>(</span><span class="hljs-operator">!</span><span>_meshes.keys.contains(meshReference.id)) {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span>            _meshes.updateValue(meshReference.load(), forKey: meshReference.id)
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span>        }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>        </span><span style="font-weight:bold">return</span><span> _meshes[meshReference.id]</span><span class="hljs-operator">!</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>}</code></div></pre>
<hr/>
<h2 id="model-mesh-loader">Model Mesh Loader</h2>
<p>Will be in charge of actually using <strong>ModelIO</strong> to load the data for the <strong>vertices</strong> from the <strong>.obj</strong> file.</p>
<p>It will <strong>initialize</strong> a <strong>vertex descriptor</strong> off of our <strong>metal BasicVertexDescriptor</strong>.</p>
<p>Since <strong>.obj</strong> files can contain <strong>multiple meshes</strong> inside, we will also just return the one specified in the <strong>mesh reference</strong>.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">ModelMeshLoader</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>    </span><span style="font-weight:bold">private</span><span> </span><span style="font-weight:bold">var</span><span> _meshReference: </span><span style="color:#880000">ModelMeshReference</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>    </span><span class="hljs-function" style="font-weight:bold">init</span><span class="hljs-function">(</span><span class="hljs-function" style="font-weight:bold">_</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">meshReference</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">ModelMeshReference</span><span class="hljs-function">)</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>        _meshReference </span><span class="hljs-operator">=</span><span> meshReference
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">load</span><span class="hljs-function">()</span><span>-&gt;</span><span style="color:#880000">Mesh</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>        </span><span style="font-weight:bold">guard</span><span> </span><span style="font-weight:bold">let</span><span> url </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">Bundle</span><span>.main.url(forResource: _meshReference.name, withExtension: _meshReference.fileExtension) </span><span style="font-weight:bold">else</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span><span>            </span><span style="color:#397300">fatalError</span><span>(</span><span style="color:#880000">&quot;ERROR::LOADING::MODEL::__</span><span style="color:#444">\(_meshReference.name</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">.</span><span style="color:#444">\(_meshReference.fileExtension</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">__::does not exist&quot;</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span>        }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span><span>        </span><span style="font-weight:bold">let</span><span> vertexDescriptor </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MTKModelIOVertexDescriptorFromMetal</span><span>(</span><span style="color:#880000">VertexDescriptorCache</span><span>.get(.</span><span style="color:#880000">Basic</span><span>))
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span><span>        </span><span style="color:#888888">// make each attribute mapped to each attribute type</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span><span>        (vertexDescriptor.attributes[</span><span style="color:#880000">0</span><span>] </span><span style="font-weight:bold">as!</span><span> </span><span style="color:#880000">MDLVertexAttribute</span><span>).name </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MDLVertexAttributePosition</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span><span>        (vertexDescriptor.attributes[</span><span style="color:#880000">1</span><span>] </span><span style="font-weight:bold">as!</span><span> </span><span style="color:#880000">MDLVertexAttribute</span><span>).name </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MDLVertexAttributeNormal</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span><span>        (vertexDescriptor.attributes[</span><span style="color:#880000">2</span><span>] </span><span style="font-weight:bold">as!</span><span> </span><span style="color:#880000">MDLVertexAttribute</span><span>).name </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MDLVertexAttributeColor</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span><span>        (vertexDescriptor.attributes[</span><span style="color:#880000">3</span><span>] </span><span style="font-weight:bold">as!</span><span> </span><span style="color:#880000">MDLVertexAttribute</span><span>).name </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MDLVertexAttributeTextureCoordinate</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span><span>        </span><span style="font-weight:bold">let</span><span> bufferAllocator </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MTKMeshBufferAllocator</span><span>(device: </span><span style="color:#880000">Engine</span><span>.device)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">22</span><span>        </span><span style="font-weight:bold">let</span><span> asset: </span><span style="color:#880000">MDLAsset</span><span> </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MDLAsset</span><span>(
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">23</span>            url: url,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">24</span>            vertexDescriptor: vertexDescriptor,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">25</span>            bufferAllocator: bufferAllocator
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">26</span>        )
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">27</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">28</span><span>        </span><span style="font-weight:bold">var</span><span> meshes: [</span><span style="font-weight:bold">Any</span><span>]</span><span class="hljs-operator">!</span><span> </span><span class="hljs-operator">=</span><span> []
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">29</span><span>        </span><span style="font-weight:bold">do</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">30</span><span>            meshes </span><span class="hljs-operator">=</span><span> </span><span style="font-weight:bold">try</span><span> </span><span style="color:#880000">MTKMesh</span><span>.newMeshes(asset: asset, device: </span><span style="color:#880000">Engine</span><span>.device).metalKitMeshes
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">31</span><span>        } </span><span style="font-weight:bold">catch</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">32</span><span>            </span><span style="color:#397300">print</span><span>(</span><span style="color:#880000">&quot;ERROR::LOADING::MODEL::__</span><span style="color:#444">\(_meshReference.name</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">.</span><span style="color:#444">\(_meshReference.fileExtension</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">__::</span><span style="color:#444">\(error)</span><span style="color:#880000">&quot;</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">33</span>        }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">34</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">35</span><span>        </span><span style="font-weight:bold">return</span><span> </span><span style="color:#880000">ModelMesh</span><span>(loadedMesh: meshes[_meshReference.meshIndex])
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">36</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">37</span>}</code></div></pre>
<hr/>
<h2 id="mesh">Mesh</h2>
<p><strong>Meshes</strong> now differentiate, <strong>BuiltIn Meshes</strong> have just a <strong>vertex buffer</strong> and an <strong>index buffer</strong>.</p>
<p><strong>Model Meshes</strong> have a <strong>MTKMesh</strong> inside, that will grant access to the different vertex and index buffers.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">Mesh</span><span class="hljs-class"> </span><span>{}
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span><span></span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">BuiltInMesh</span><span class="hljs-class"> : </span><span class="hljs-class" style="color:#880000;font-weight:bold">Mesh</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> vertices: [</span><span style="color:#880000">Vertex</span><span>]</span><span class="hljs-operator">!</span><span> </span><span class="hljs-operator">=</span><span> []
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> indices: [</span><span style="color:#880000">UInt32</span><span>]</span><span class="hljs-operator">!</span><span> </span><span class="hljs-operator">=</span><span> []
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> vertexBuffer: </span><span style="color:#880000">MTLBuffer</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> indexBuffer: </span><span style="color:#880000">MTLBuffer</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span><span>    </span><span style="font-weight:bold">override</span><span> </span><span class="hljs-function" style="font-weight:bold">init</span><span class="hljs-function">()</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>        </span><span style="font-weight:bold">super</span><span>.</span><span style="font-weight:bold">init</span><span>()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span>        createMesh()
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span><span>        vertexBuffer </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">Engine</span><span>.device.makeBuffer(bytes: vertices, length: </span><span style="color:#880000">Vertex</span><span>.stride </span><span class="hljs-operator">*</span><span> vertices.count, options: [])
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span><span>        </span><span style="font-weight:bold">if</span><span>(indices.count </span><span class="hljs-operator">&gt;</span><span> </span><span style="color:#880000">0</span><span>){
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span><span>            indexBuffer </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">Engine</span><span>.device.makeBuffer(bytes: indices, length: </span><span style="color:#880000">UInt32</span><span>.stride </span><span class="hljs-operator">*</span><span> indices.count, options: [])
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span>        }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span><span>    </span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">createMesh</span><span class="hljs-function">()</span><span> {}
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">22</span>}
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">23</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">24</span><span></span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">ModelMesh</span><span class="hljs-class"> : </span><span class="hljs-class" style="color:#880000;font-weight:bold">Mesh</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">25</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> mtkMesh: </span><span style="color:#880000">MTKMesh</span><span>? </span><span class="hljs-operator">=</span><span> </span><span style="color:#78A960">nil</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">26</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">27</span><span>    </span><span class="hljs-function" style="font-weight:bold">init</span><span class="hljs-function">(</span><span class="hljs-function hljs-params">loadedMesh</span><span class="hljs-function">: </span><span class="hljs-function" style="font-weight:bold">Any</span><span class="hljs-function">)</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">28</span><span>        </span><span style="font-weight:bold">super</span><span>.</span><span style="font-weight:bold">init</span><span>()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">29</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">30</span><span>        </span><span style="font-weight:bold">if</span><span> </span><span style="font-weight:bold">let</span><span> metalKitMesh </span><span class="hljs-operator">=</span><span> loadedMesh </span><span style="font-weight:bold">as?</span><span> </span><span style="color:#880000">MTKMesh</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">31</span><span>            </span><span style="font-weight:bold">self</span><span>.mtkMesh </span><span class="hljs-operator">=</span><span> metalKitMesh
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">32</span>        }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">33</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">34</span>}</code></div></pre>
<hr/>
<h2 id="mesh-renderer">Mesh Renderer</h2>
<p>The <strong>Mesh Renderer</strong> will decide how to render the mesh, depending on if it&#x27;s a <strong>built in mesh</strong>, or a <strong>model mesh</strong>.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">doRender</span><span class="hljs-function">()</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span style="color:#880000">Graphics</span><span>.renderCommandEncoder.setRenderPipelineState(</span><span style="color:#880000">RenderPipelineStateCache</span><span>.get(_material))
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>    </span><span style="color:#888888">// Vertex Shader data</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>    </span><span style="color:#880000">Graphics</span><span>.renderCommandEncoder.setVertexBytes(</span><span class="hljs-operator">&amp;</span><span>_modelConstants, length: </span><span style="color:#880000">ModelConstants</span><span>.stride, index: </span><span style="color:#880000">1</span><span>) </span><span style="color:#888888">// model matrix</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span>    _material.setGpuValues()
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span><span>    </span><span style="color:#880000">Graphics</span><span>.renderCommandEncoder.setDepthStencilState(</span><span style="color:#880000">DepthStencilStateCache</span><span>.get(.</span><span style="color:#880000">Less</span><span>))
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span><span>    </span><span style="font-weight:bold">let</span><span> mesh </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MeshCache</span><span>.get(_meshReference)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span><span>    </span><span style="font-weight:bold">if</span><span> </span><span style="font-weight:bold">let</span><span> builtInMesh </span><span class="hljs-operator">=</span><span> mesh </span><span style="font-weight:bold">as?</span><span> </span><span style="color:#880000">BuiltInMesh</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span>        renderBuiltInMesh(builtInMesh)
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span><span>    } </span><span style="font-weight:bold">else</span><span> </span><span style="font-weight:bold">if</span><span> </span><span style="font-weight:bold">let</span><span> modelMesh </span><span class="hljs-operator">=</span><span> mesh </span><span style="font-weight:bold">as?</span><span> </span><span style="color:#880000">ModelMesh</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span>        renderModelMesh(modelMesh)
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span>}
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span><span></span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">renderBuiltInMesh</span><span class="hljs-function">(</span><span class="hljs-function" style="font-weight:bold">_</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">mesh</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">BuiltInMesh</span><span class="hljs-function">)</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">22</span><span>    </span><span style="color:#880000">Graphics</span><span>.renderCommandEncoder.setVertexBuffer(mesh.vertexBuffer, offset: </span><span style="color:#880000">0</span><span>, index: </span><span style="color:#880000">0</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">23</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">24</span><span>    </span><span style="font-weight:bold">if</span><span>(mesh.indices.count </span><span class="hljs-operator">&gt;</span><span> </span><span style="color:#880000">0</span><span>){
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">25</span><span>        </span><span style="color:#880000">Graphics</span><span>.renderCommandEncoder.drawIndexedPrimitives(
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">26</span><span>            type: </span><span style="color:#880000">MTLPrimitiveType</span><span>.triangle,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">27</span>            indexCount: mesh.indices.count,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">28</span><span>            indexType: </span><span style="color:#880000">MTLIndexType</span><span>.uint32,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">29</span>            indexBuffer: mesh.indexBuffer,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">30</span><span>            indexBufferOffset: </span><span style="color:#880000">0</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">31</span><span>            instanceCount: </span><span style="color:#880000">1</span><span> </span><span style="color:#888888">// for now, might change in the future</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">32</span>        )
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">33</span><span>    } </span><span style="font-weight:bold">else</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">34</span><span>        </span><span style="color:#880000">Graphics</span><span>.renderCommandEncoder.drawPrimitives(
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">35</span><span>            type: </span><span style="color:#880000">MTLPrimitiveType</span><span>.triangle,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">36</span><span>            vertexStart: </span><span style="color:#880000">0</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">37</span>            vertexCount: mesh.vertices.count
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">38</span>        )
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">39</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">40</span>}
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">41</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">42</span><span></span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">renderModelMesh</span><span class="hljs-function">(</span><span class="hljs-function" style="font-weight:bold">_</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">mesh</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">ModelMesh</span><span class="hljs-function">)</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">43</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">44</span><span>    </span><span style="font-weight:bold">if</span><span>(mesh.mtkMesh </span><span class="hljs-operator">==</span><span> </span><span style="color:#78A960">nil</span><span>) { </span><span style="font-weight:bold">return</span><span> }
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">45</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">46</span><span>    </span><span style="font-weight:bold">for</span><span> vertexBuffer </span><span style="font-weight:bold">in</span><span> mesh.mtkMesh</span><span class="hljs-operator">!</span><span>.vertexBuffers {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">47</span><span>        </span><span style="color:#880000">Graphics</span><span>.renderCommandEncoder.setVertexBuffer(vertexBuffer.buffer, offset: vertexBuffer.offset, index: </span><span style="color:#880000">0</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">48</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">49</span><span>        </span><span style="font-weight:bold">for</span><span> submesh </span><span style="font-weight:bold">in</span><span> mesh.mtkMesh</span><span class="hljs-operator">!</span><span>.submeshes {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">50</span><span>            </span><span style="color:#880000">Graphics</span><span>.renderCommandEncoder.drawIndexedPrimitives(
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">51</span>                type: submesh.primitiveType,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">52</span>                indexCount: submesh.indexCount,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">53</span>                indexType: submesh.indexType,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">54</span>                indexBuffer: submesh.indexBuffer.buffer,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">55</span>                indexBufferOffset: submesh.indexBuffer.offset,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">56</span><span>                instanceCount: </span><span style="color:#880000">1</span><span> </span><span style="color:#888888">// for now, might change in the future</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">57</span>            )
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">58</span>        }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">59</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">60</span>}</code></div></pre>
<hr/>
<h2 id="textures">Textures</h2>
<p>Similar to how we handle meshes, <strong>Textures</strong> will have a <strong>Texture Reference</strong> that will act as an id in the <strong>Texture Cache</strong>.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">TextureReference</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> name: </span><span style="color:#880000">String</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> fileExtension: </span><span style="color:#880000">String</span><span>! </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">&quot;jpg&quot;</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> textureLoaderOrigin: </span><span style="color:#880000">MTKTextureLoader</span><span>.</span><span style="color:#880000">Origin</span><span>! </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MTKTextureLoader</span><span>.</span><span style="color:#880000">Origin</span><span>.topLeft
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span style="font-weight:bold">var</span><span> id: </span><span style="color:#880000">String</span><span>! {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>        </span><span style="font-weight:bold">return</span><span> </span><span style="color:#880000">&quot;</span><span style="color:#444">\(name</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">.</span><span style="color:#444">\(fileExtension</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">:</span><span style="color:#444">\(textureLoaderOrigin</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">&quot;</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span><span>    </span><span class="hljs-function" style="font-weight:bold">init</span><span class="hljs-function">(
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class="hljs-function">        </span><span class="hljs-function" style="font-weight:bold">_</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">name</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">String</span><span class="hljs-function">,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class="hljs-function">        </span><span class="hljs-function hljs-params">fileExtension</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">String</span><span class="hljs-function"> </span><span class="hljs-function hljs-operator">=</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000">&quot;jpg&quot;</span><span class="hljs-function">,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span><span class="hljs-function">        </span><span class="hljs-function hljs-params">textureLoaderOrigin</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">MTKTextureLoader</span><span class="hljs-function">.</span><span class="hljs-function" style="color:#880000">Origin</span><span class="hljs-function"> </span><span class="hljs-function hljs-operator">=</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000">MTKTextureLoader</span><span class="hljs-function">.</span><span class="hljs-function" style="color:#880000">Origin</span><span class="hljs-function">.topLeft
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class="hljs-function">    )</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span><span>        </span><span style="font-weight:bold">self</span><span>.name </span><span class="hljs-operator">=</span><span> name
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">16</span><span>        </span><span style="font-weight:bold">self</span><span>.fileExtension </span><span class="hljs-operator">=</span><span> fileExtension
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">17</span><span>        </span><span style="font-weight:bold">self</span><span>.textureLoaderOrigin </span><span class="hljs-operator">=</span><span> textureLoaderOrigin
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">18</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">19</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">20</span><span>    </span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">load</span><span class="hljs-function">()</span><span>-&gt;</span><span style="color:#880000">MTLTexture</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">21</span><span>        </span><span style="font-weight:bold">return</span><span> </span><span style="color:#880000">TextureLoader</span><span>(</span><span style="font-weight:bold">self</span><span>).load()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">22</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">23</span>}</code></div></pre>
<p>And the <strong>Texture Reference</strong> will use the <strong>Texture Loader</strong> to load the corresponding <strong>MTLTexture</strong>.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">TextureLoader</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>    </span><span style="font-weight:bold">private</span><span> </span><span style="font-weight:bold">var</span><span> _textureReference: </span><span style="color:#880000">TextureReference</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>    </span><span class="hljs-function" style="font-weight:bold">init</span><span class="hljs-function">(</span><span class="hljs-function" style="font-weight:bold">_</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">textureReference</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">TextureReference</span><span class="hljs-function">)</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>        _textureReference </span><span class="hljs-operator">=</span><span> textureReference
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">load</span><span class="hljs-function">()</span><span>-&gt;</span><span style="color:#880000">MTLTexture</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>        </span><span style="font-weight:bold">var</span><span> result: </span><span style="color:#880000">MTLTexture</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>        </span><span style="font-weight:bold">guard</span><span> </span><span style="font-weight:bold">let</span><span> url </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">Bundle</span><span>.main.url(forResource: _textureReference.name, withExtension: _textureReference.fileExtension) </span><span style="font-weight:bold">else</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span>            </span><span style="color:#397300">fatalError</span><span>(</span><span style="color:#880000">&quot;ERROR::LOADING::TEXTURE::__</span><span style="color:#444">\(_textureReference.name</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">.</span><span style="color:#444">\(_textureReference.fileExtension</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">__::does not exist&quot;</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>        }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span><span>        </span><span style="font-weight:bold">let</span><span> loader </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MTKTextureLoader</span><span>(device: </span><span style="color:#880000">Engine</span><span>.device)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">16</span><span>        </span><span style="font-weight:bold">let</span><span> options: [</span><span style="color:#880000">MTKTextureLoader</span><span>.</span><span style="color:#880000">Option</span><span>: </span><span style="font-weight:bold">Any</span><span>] </span><span class="hljs-operator">=</span><span> [</span><span style="color:#880000">MTKTextureLoader</span><span>.</span><span style="color:#880000">Option</span><span>.origin : _textureReference.textureLoaderOrigin</span><span class="hljs-operator">!</span><span>]
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">17</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">18</span><span>        </span><span style="font-weight:bold">do</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">19</span><span>            result </span><span class="hljs-operator">=</span><span> </span><span style="font-weight:bold">try</span><span> loader.newTexture(URL: url, options: options)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">20</span><span>            result.label </span><span class="hljs-operator">=</span><span> _textureReference.name
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">21</span><span>        } </span><span style="font-weight:bold">catch</span><span> </span><span style="font-weight:bold">let</span><span> error </span><span style="font-weight:bold">as</span><span> </span><span style="color:#880000">NSError</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">22</span><span>            </span><span style="color:#397300">print</span><span>(</span><span style="color:#880000">&quot;ERROR::LOADING::TEXTURE::__</span><span style="color:#444">\(_textureReference.name</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">.</span><span style="color:#444">\(_textureReference.fileExtension</span><span class="hljs-operator" style="color:#444">!</span><span style="color:#444">)</span><span style="color:#880000">__::</span><span style="color:#444">\(error)</span><span style="color:#880000">&quot;</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">23</span>        }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">24</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">25</span><span>        </span><span style="font-weight:bold">return</span><span> result
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">26</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">27</span>}</code></div></pre>
<p>This will allow us to load any texture asset, without needing an enumerator.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">TextureCache</span><span class="hljs-class"> : </span><span class="hljs-class" style="color:#880000;font-weight:bold">Cache</span><span class="hljs-class">&lt;</span><span class="hljs-class" style="color:#880000;font-weight:bold">TextureReference</span><span class="hljs-class">, </span><span class="hljs-class" style="color:#880000;font-weight:bold">MTLTexture</span><span class="hljs-class">&gt; </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span style="font-weight:bold">private</span><span> </span><span style="font-weight:bold">static</span><span> </span><span style="font-weight:bold">var</span><span> _textures: [</span><span style="color:#880000">String</span><span>: </span><span style="color:#880000">MTLTexture</span><span>] </span><span class="hljs-operator">=</span><span> [:]
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>    </span><span style="font-weight:bold">override</span><span> </span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">func</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">get</span><span class="hljs-class">(</span><span class="hljs-class" style="color:#880000;font-weight:bold">_</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">textureReference</span><span class="hljs-class">: </span><span class="hljs-class" style="color:#880000;font-weight:bold">TextureReference</span><span class="hljs-class">)-&gt;</span><span class="hljs-class" style="color:#880000;font-weight:bold">MTLTexture</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>        </span><span style="font-weight:bold">if</span><span>(</span><span class="hljs-operator">!</span><span>_textures.keys.contains(textureReference.id)) {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span>            _textures.updateValue(textureReference.load(), forKey: textureReference.id)
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span>        }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>        </span><span style="font-weight:bold">return</span><span> _textures[textureReference.id]</span><span class="hljs-operator">!</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>}</code></div></pre>
<hr/>
<h2 id="model-game-object">Model Game Object</h2>
<p>Will take in a <strong>Mesh Reference</strong> and a <strong>Texture Reference</strong>.</p>
<p>Internally it will add a <strong>Mesh Renderer</strong> using the <strong>mesh reference</strong>, and also will set the <strong>Material</strong> to <strong>sample the texture</strong> using the <strong>texture coordinates</strong>.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">ModelGameObject</span><span class="hljs-class"> : </span><span class="hljs-class" style="color:#880000;font-weight:bold">GameObject</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span class="hljs-function" style="font-weight:bold">init</span><span class="hljs-function">(
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="hljs-function">        </span><span class="hljs-function hljs-params">modelMeshReference</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">ModelMeshReference</span><span class="hljs-function">,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="hljs-function">        </span><span class="hljs-function hljs-params">textureReference</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">TextureReference</span><span class="hljs-function">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="hljs-function">    )</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>        </span><span style="font-weight:bold">super</span><span>.</span><span style="font-weight:bold">init</span><span>()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>        </span><span style="font-weight:bold">let</span><span> material </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">TextureSampleMaterial</span><span>(textureReference)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>        </span><span style="font-weight:bold">self</span><span>.addComponent(</span><span style="color:#880000">MeshRenderer</span><span>(meshReference: modelMeshReference, material: material))
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span>        </span><span style="font-weight:bold">self</span><span>.addComponent(</span><span style="color:#880000">RotateYComponent</span><span>())
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span>}</code></div></pre>
<p>To set up the <strong>scene</strong> that uses our <strong>Samus.obj</strong> file, we need to do:</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span style="font-weight:bold">let</span><span> samusGameObject </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">ModelGameObject</span><span>(
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>    modelMeshReference: </span><span style="color:#880000">ModelMeshReference</span><span>(</span><span style="color:#880000">&quot;samus&quot;</span><span>),
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    textureReference: </span><span style="color:#880000">TextureReference</span><span>(</span><span style="color:#880000">&quot;samus&quot;</span><span>, fileExtension: </span><span style="color:#880000">&quot;png&quot;</span><span>, textureLoaderOrigin: </span><span style="color:#880000">MTKTextureLoader</span><span>.</span><span style="color:#880000">Origin</span><span>.bottomLeft)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span>)</code></div></pre>
<hr/>
<h2 id="result">Result</h2>
<p>The screen now shows the <strong>3D model of Samus</strong>, with its <strong>base texture</strong> correctly sampled.</p>
<p><img src="/images/blog/metal-render-pipeline-part-15-loading-and-rendering-obj-models/cover.jpg" alt="Picture"/></p></div></article><div style="padding-top:3.5em"></div></main><footer class="Footer_footer__rEL09"><p>¬©<!-- --> 2023, Gonzalo Cumini</p><ul class="Footer_icons__IyNdc"><li class="Footer_icon__mhtwE"><a href="https://linkedin.com/in/gonzacn" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li><li class="Footer_icon__mhtwE"><a href="https://github.com/z4gon" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li></ul></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"metal-render-pipeline-part-15-loading-and-rendering-obj-models","date":"2023-01-02T00:00:00.000Z","author":{"name":"Gonzalo Cumini","pictureUrl":"/images/avatars/z4gon.jpg"},"title":"Metal Render Pipeline Part 15: Loading and Rendering .OBJ Models","excerpt":"Mesh References describing the .OBJ asset and how to load it. Mesh Loader to actually use ModelIO and load the MTKMeshes out of the .OBJ file, using a MTKModelIOVertexDescriptor. Extending the Mesh class to have two subclasses, the BuiltInMesh and the ModelMesh. The Model Mesh will have a reference to the MTKMesh with all the submeshes, vertex and index buffers. Modifying the Mesh Renderer to be able to render MTKMeshes. Using Texture References and Texture Loaders to load any needed texture for the models.","coverImageUrl":"/images/blog/metal-render-pipeline-part-15-loading-and-rendering-obj-models/cover.jpg","coverImageSourceUrl":"","coverVideoUrl":"/videos/blog/metal-render-pipeline-part-15-loading-and-rendering-obj-models/1.mp4","markdownContent":"\n## Source Code\n\n[See Project in GitHub üë©‚Äçüíª](https://github.com/z4gon/metal-render-pipeline)\n\n## References\n\n- [Metal Render Pipeline tutorial series by Rick Twohy](https://www.youtube.com/playlist?list=PLEXt1-oJUa4BVgjZt9tK2MhV_DW7PVDsg)\n\n## Table of Content\n\n- [Model Mesh Reference](#model-mesh-reference)\n- [Model Mesh Loader](#model-mesh-loader)\n- [Mesh](#mesh)\n- [Mesh Renderer](#mesh-renderer)\n- [Textures](#textures)\n- [Model Game Object](#model-game-object)\n- [Result](#result)\n\n---\n\n## Model Mesh Reference\n\nThe **Model Mesh Reference** will point to the asset that we want to load from.\n\nIt will also have a **load()** method that will be in charge of initializing the actual **Mesh** object.\n\n```swift\nprotocol MeshReference {\n    var id: String! { get }\n    func load()-\u003eMesh\n}\n\nclass ModelMeshReference : MeshReference {\n    public var name: String!\n    public var fileExtension: String! = \"obj\"\n    public var meshIndex: Int = 0\n\n    public var id: String! {\n        return \"\\(name!).\\(fileExtension!):\\(meshIndex)\"\n    }\n\n    init(\n        _ name: String,\n        fileExtension: String = \"obj\",\n        meshIndex: Int = 0\n    ){\n        self.name = name\n        self.fileExtension = fileExtension\n        self.meshIndex = meshIndex\n    }\n\n    func load()-\u003eMesh {\n        return ModelMeshLoader(self).load()\n    }\n}\n```\n\nThis will act as an **identifier** when caching model meshes in the corresponding cache.\n\n```swift\n    public var id: String! {\n        return \"\\(name!).\\(fileExtension!):\\(meshIndex)\"\n    }\n```\n\n```swift\nclass MeshCache : Cache\u003cMeshReference, Mesh\u003e {\n\n    private static var _meshes: [String: Mesh] = [:]\n\n    override class func get(_ meshReference: MeshReference)-\u003eMesh{\n\n        if(!_meshes.keys.contains(meshReference.id)) {\n            _meshes.updateValue(meshReference.load(), forKey: meshReference.id)\n        }\n\n        return _meshes[meshReference.id]!\n    }\n}\n```\n\n---\n\n## Model Mesh Loader\n\nWill be in charge of actually using **ModelIO** to load the data for the **vertices** from the **.obj** file.\n\nIt will **initialize** a **vertex descriptor** off of our **metal BasicVertexDescriptor**.\n\nSince **.obj** files can contain **multiple meshes** inside, we will also just return the one specified in the **mesh reference**.\n\n```swift\nclass ModelMeshLoader {\n    private var _meshReference: ModelMeshReference!\n\n    init(_ meshReference: ModelMeshReference) {\n        _meshReference = meshReference\n    }\n\n    public func load()-\u003eMesh {\n        guard let url = Bundle.main.url(forResource: _meshReference.name, withExtension: _meshReference.fileExtension) else {\n            fatalError(\"ERROR::LOADING::MODEL::__\\(_meshReference.name!).\\(_meshReference.fileExtension!)__::does not exist\")\n        }\n\n        let vertexDescriptor = MTKModelIOVertexDescriptorFromMetal(VertexDescriptorCache.get(.Basic))\n\n        // make each attribute mapped to each attribute type\n        (vertexDescriptor.attributes[0] as! MDLVertexAttribute).name = MDLVertexAttributePosition\n        (vertexDescriptor.attributes[1] as! MDLVertexAttribute).name = MDLVertexAttributeNormal\n        (vertexDescriptor.attributes[2] as! MDLVertexAttribute).name = MDLVertexAttributeColor\n        (vertexDescriptor.attributes[3] as! MDLVertexAttribute).name = MDLVertexAttributeTextureCoordinate\n\n        let bufferAllocator = MTKMeshBufferAllocator(device: Engine.device)\n        let asset: MDLAsset = MDLAsset(\n            url: url,\n            vertexDescriptor: vertexDescriptor,\n            bufferAllocator: bufferAllocator\n        )\n\n        var meshes: [Any]! = []\n        do {\n            meshes = try MTKMesh.newMeshes(asset: asset, device: Engine.device).metalKitMeshes\n        } catch {\n            print(\"ERROR::LOADING::MODEL::__\\(_meshReference.name!).\\(_meshReference.fileExtension!)__::\\(error)\")\n        }\n\n        return ModelMesh(loadedMesh: meshes[_meshReference.meshIndex])\n    }\n}\n```\n\n---\n\n## Mesh\n\n**Meshes** now differentiate, **BuiltIn Meshes** have just a **vertex buffer** and an **index buffer**.\n\n**Model Meshes** have a **MTKMesh** inside, that will grant access to the different vertex and index buffers.\n\n```swift\nclass Mesh {}\n\nclass BuiltInMesh : Mesh {\n    public var vertices: [Vertex]! = []\n    public var indices: [UInt32]! = []\n\n    public var vertexBuffer: MTLBuffer!\n    public var indexBuffer: MTLBuffer!\n\n    override init() {\n        super.init()\n        createMesh()\n\n        vertexBuffer = Engine.device.makeBuffer(bytes: vertices, length: Vertex.stride * vertices.count, options: [])\n\n        if(indices.count \u003e 0){\n            indexBuffer = Engine.device.makeBuffer(bytes: indices, length: UInt32.stride * indices.count, options: [])\n        }\n    }\n\n    func createMesh() {}\n}\n\nclass ModelMesh : Mesh {\n    public var mtkMesh: MTKMesh? = nil\n\n    init(loadedMesh: Any) {\n        super.init()\n\n        if let metalKitMesh = loadedMesh as? MTKMesh {\n            self.mtkMesh = metalKitMesh\n        }\n    }\n}\n```\n\n---\n\n## Mesh Renderer\n\nThe **Mesh Renderer** will decide how to render the mesh, depending on if it's a **built in mesh**, or a **model mesh**.\n\n```swift\nfunc doRender() {\n\n    Graphics.renderCommandEncoder.setRenderPipelineState(RenderPipelineStateCache.get(_material))\n\n    // Vertex Shader data\n    Graphics.renderCommandEncoder.setVertexBytes(\u0026_modelConstants, length: ModelConstants.stride, index: 1) // model matrix\n\n    _material.setGpuValues()\n\n    Graphics.renderCommandEncoder.setDepthStencilState(DepthStencilStateCache.get(.Less))\n\n    let mesh = MeshCache.get(_meshReference)\n\n    if let builtInMesh = mesh as? BuiltInMesh {\n        renderBuiltInMesh(builtInMesh)\n    } else if let modelMesh = mesh as? ModelMesh {\n        renderModelMesh(modelMesh)\n    }\n}\n\nfunc renderBuiltInMesh(_ mesh: BuiltInMesh) {\n    Graphics.renderCommandEncoder.setVertexBuffer(mesh.vertexBuffer, offset: 0, index: 0)\n\n    if(mesh.indices.count \u003e 0){\n        Graphics.renderCommandEncoder.drawIndexedPrimitives(\n            type: MTLPrimitiveType.triangle,\n            indexCount: mesh.indices.count,\n            indexType: MTLIndexType.uint32,\n            indexBuffer: mesh.indexBuffer,\n            indexBufferOffset: 0,\n            instanceCount: 1 // for now, might change in the future\n        )\n    } else {\n        Graphics.renderCommandEncoder.drawPrimitives(\n            type: MTLPrimitiveType.triangle,\n            vertexStart: 0,\n            vertexCount: mesh.vertices.count\n        )\n    }\n}\n\nfunc renderModelMesh(_ mesh: ModelMesh) {\n\n    if(mesh.mtkMesh == nil) { return }\n\n    for vertexBuffer in mesh.mtkMesh!.vertexBuffers {\n        Graphics.renderCommandEncoder.setVertexBuffer(vertexBuffer.buffer, offset: vertexBuffer.offset, index: 0)\n\n        for submesh in mesh.mtkMesh!.submeshes {\n            Graphics.renderCommandEncoder.drawIndexedPrimitives(\n                type: submesh.primitiveType,\n                indexCount: submesh.indexCount,\n                indexType: submesh.indexType,\n                indexBuffer: submesh.indexBuffer.buffer,\n                indexBufferOffset: submesh.indexBuffer.offset,\n                instanceCount: 1 // for now, might change in the future\n            )\n        }\n    }\n}\n```\n\n---\n\n## Textures\n\nSimilar to how we handle meshes, **Textures** will have a **Texture Reference** that will act as an id in the **Texture Cache**.\n\n```swift\nclass TextureReference {\n    public var name: String!\n    public var fileExtension: String! = \"jpg\"\n    public var textureLoaderOrigin: MTKTextureLoader.Origin! = MTKTextureLoader.Origin.topLeft\n\n    public var id: String! {\n        return \"\\(name!).\\(fileExtension!):\\(textureLoaderOrigin!)\"\n    }\n\n    init(\n        _ name: String,\n        fileExtension: String = \"jpg\",\n        textureLoaderOrigin: MTKTextureLoader.Origin = MTKTextureLoader.Origin.topLeft\n    ){\n        self.name = name\n        self.fileExtension = fileExtension\n        self.textureLoaderOrigin = textureLoaderOrigin\n    }\n\n    func load()-\u003eMTLTexture {\n        return TextureLoader(self).load()\n    }\n}\n```\n\nAnd the **Texture Reference** will use the **Texture Loader** to load the corresponding **MTLTexture**.\n\n```swift\nclass TextureLoader {\n    private var _textureReference: TextureReference!\n\n    init(_ textureReference: TextureReference) {\n        _textureReference = textureReference\n    }\n\n    public func load()-\u003eMTLTexture {\n        var result: MTLTexture!\n\n        guard let url = Bundle.main.url(forResource: _textureReference.name, withExtension: _textureReference.fileExtension) else {\n            fatalError(\"ERROR::LOADING::TEXTURE::__\\(_textureReference.name!).\\(_textureReference.fileExtension!)__::does not exist\")\n        }\n\n        let loader = MTKTextureLoader(device: Engine.device)\n        let options: [MTKTextureLoader.Option: Any] = [MTKTextureLoader.Option.origin : _textureReference.textureLoaderOrigin!]\n\n        do {\n            result = try loader.newTexture(URL: url, options: options)\n            result.label = _textureReference.name\n        } catch let error as NSError {\n            print(\"ERROR::LOADING::TEXTURE::__\\(_textureReference.name!).\\(_textureReference.fileExtension!)__::\\(error)\")\n        }\n\n        return result\n    }\n}\n```\n\nThis will allow us to load any texture asset, without needing an enumerator.\n\n```swift\nclass TextureCache : Cache\u003cTextureReference, MTLTexture\u003e {\n\n    private static var _textures: [String: MTLTexture] = [:]\n\n    override class func get(_ textureReference: TextureReference)-\u003eMTLTexture{\n\n        if(!_textures.keys.contains(textureReference.id)) {\n            _textures.updateValue(textureReference.load(), forKey: textureReference.id)\n        }\n\n        return _textures[textureReference.id]!\n    }\n}\n```\n\n---\n\n## Model Game Object\n\nWill take in a **Mesh Reference** and a **Texture Reference**.\n\nInternally it will add a **Mesh Renderer** using the **mesh reference**, and also will set the **Material** to **sample the texture** using the **texture coordinates**.\n\n```swift\nclass ModelGameObject : GameObject {\n\n    init(\n        modelMeshReference: ModelMeshReference,\n        textureReference: TextureReference\n    ) {\n        super.init()\n\n        let material = TextureSampleMaterial(textureReference)\n\n        self.addComponent(MeshRenderer(meshReference: modelMeshReference, material: material))\n        self.addComponent(RotateYComponent())\n    }\n}\n```\n\nTo set up the **scene** that uses our **Samus.obj** file, we need to do:\n\n```swift\nlet samusGameObject = ModelGameObject(\n    modelMeshReference: ModelMeshReference(\"samus\"),\n    textureReference: TextureReference(\"samus\", fileExtension: \"png\", textureLoaderOrigin: MTKTextureLoader.Origin.bottomLeft)\n)\n```\n\n---\n\n## Result\n\nThe screen now shows the **3D model of Samus**, with its **base texture** correctly sampled.\n\n![Picture](/images/blog/metal-render-pipeline-part-15-loading-and-rendering-obj-models/cover.jpg)\n"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"metal-render-pipeline-part-15-loading-and-rendering-obj-models"},"buildId":"dySdq6Xb0NnqayZdO7C_6","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>