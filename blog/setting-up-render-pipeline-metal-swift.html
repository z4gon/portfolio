<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Render Pipeline with Metal and Swift: Part 1 | Blog</title><meta name="title" content="Render Pipeline with Metal and Swift: Part 1 | Blog"/><meta name="description" content="Following the amazing tutorial series by Rick Twohy, creating a basic macos app project in xcode using Swift and Storyboards. Utilizing the Metal Kit library to access the Metal APIs to render 3D graphics, initializing the basic components to setup the render pipeline and start outputing 3D graphics on the screen."/><meta property="og:type" content="website"/><meta property="og:url" content="https://z4gon.github.io"/><meta property="og:title" content="Render Pipeline with Metal and Swift: Part 1 | Blog"/><meta property="og:description" content="Following the amazing tutorial series by Rick Twohy, creating a basic macos app project in xcode using Swift and Storyboards. Utilizing the Metal Kit library to access the Metal APIs to render 3D graphics, initializing the basic components to setup the render pipeline and start outputing 3D graphics on the screen."/><meta property="og:image" content="https://z4gon.github.io/images/blog/setting-up-render-pipeline-metal-swift/cover.jpg"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:url" content="https://z4gon.github.io"/><meta property="twitter:title" content="Render Pipeline with Metal and Swift: Part 1 | Blog"/><meta property="twitter:description" content="Following the amazing tutorial series by Rick Twohy, creating a basic macos app project in xcode using Swift and Storyboards. Utilizing the Metal Kit library to access the Metal APIs to render 3D graphics, initializing the basic components to setup the render pipeline and start outputing 3D graphics on the screen."/><meta property="twitter:image" content="https://z4gon.github.io/images/blog/setting-up-render-pipeline-metal-swift/cover.jpg"/><link rel="icon" href="https://z4gon.github.io/favicon.ico"/><meta name="next-head-count" content="16"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/1fff811d6a135069.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1fff811d6a135069.css" data-n-g=""/><link rel="preload" href="/_next/static/css/4043baf079d82559.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4043baf079d82559.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-38cee4c0e358b1a3.js" defer=""></script><script src="/_next/static/chunks/framework-3b5a00d5d7e8d93b.js" defer=""></script><script src="/_next/static/chunks/main-90a34299418a0f2b.js" defer=""></script><script src="/_next/static/chunks/pages/_app-a7128038526bd4a3.js" defer=""></script><script src="/_next/static/chunks/151-db578b4ae7739a92.js" defer=""></script><script src="/_next/static/chunks/358-14c60bb94e9d94b9.js" defer=""></script><script src="/_next/static/chunks/473-ab2c126c0a656db0.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-d378d24d4b1843b3.js" defer=""></script><script src="/_next/static/LJ98T7ogm-aKp4icEWbaC/_buildManifest.js" defer=""></script><script src="/_next/static/LJ98T7ogm-aKp4icEWbaC/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,500;0,700;1,300;1,500&display=swap">@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memQYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWq8tWZ0Pw86hd0Rk5hkaVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memQYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWq8tWZ0Pw86hd0Rk_RkaVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsiH0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjr0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsg-1y4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtE6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWvU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWu06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWt06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuU6FxZCJgg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtE6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWvU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWu06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWt06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuU6FxZCJgg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="Page_page__0A7TG"><nav class="NavBar_navbar__W8B89"><ul class="NavBar_links__s6P8N"><li><a class="NavBar_titleLink__OtPh0" href="/"><h1>Gonzalo Cumini</h1></a></li><li class="NavBar_secondaryLink__TpgXh"><a href="/"><h1>Portfolio</h1></a></li><li class="NavBar_secondaryLink__TpgXh"><a href="/blog"><h1>Blog</h1></a></li></ul><ul class="NavBar_icons__Q_6kO"><li class="NavBar_icon__MjYq8"><a href="https://linkedin.com/in/gonzacn" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li><li class="NavBar_icon__MjYq8"><a href="https://github.com/z4gon" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li></ul></nav><main class="Container_container__B4HQR Container_narrow__Miio9"><div style="padding-top:3.5em"></div><article class="mb-32"><div class="PostHeader_postHeader__aw96i"><h1 class="PostTitle_postTitle__oD_V4">Render Pipeline with Metal and Swift: Part 1</h1><div class="PostHeader_authorAndDate__tbJVE"><div class="Avatar_avatar__G9F0L"><img src="/images/avatars/z4gon.jpg" alt="Gonzalo Cumini"/><div class="Avatar_name__yGpBe">Gonzalo Cumini</div></div><time class="DateFormatter_dateFormatter__UBCZJ" dateTime="2022-11-29T00:00:00.000Z">November	29, 2022</time></div><div class="CoverImage_coverImage__lFFCh"><img src="/images/blog/setting-up-render-pipeline-metal-swift/cover.jpg" alt="Cover Image for Render Pipeline with Metal and Swift: Part 1"/><a href="https://unsplash.com/photos/ICTjWYzpoc0" target="_blank" rel="noopener noreferrer">Image Source üîó</a></div></div><div class="PostBody_postBody__cf0Ic"><h2 id="source-code">Source Code</h2>
<p><a href="https://github.com/z4gon/metal-render-pipeline">See Project in GitHub üë©‚Äçüíª</a></p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.youtube.com/playlist?list=PLEXt1-oJUa4BVgjZt9tK2MhV_DW7PVDsg">Metal Render Pipeline tutorial series by Rick Twohy</a></li>
<li><a href="https://lcellentani.github.io/post/metal_introduction/">Introduction to Metal by Ludovico Cellentani</a></li>
</ul>
<hr/>
<h2 id="table-of-content">Table of Content</h2>
<ul>
<li><a href="#creating-the-xcode-project">Creating the XCode project</a></li>
<li><a href="#mtkview">MTKView</a></li>
<li><a href="#the-command-structure">The Command Structure</a>
<ul>
<li><a href="#resources">Resources</a></li>
</ul>
</li>
<li><a href="#basic-render-pipeline">Basic Render Pipeline</a>
<ul>
<li><a href="#code">Code</a>
<ul>
<li><a href="#shaders">Shaders</a></li>
<li><a href="#game-view">Game View</a></li>
</ul>
</li>
<li><a href="#result">Result</a></li>
</ul>
</li>
</ul>
<hr/>
<h2 id="creating-the-xcode-project">Creating the XCode project</h2>
<p>We just need to create a very basic <strong>macOS</strong> app using <strong>Swift</strong> and <strong>Storyboards</strong> for the UI.</p>
<p><img src="/images/blog/setting-up-render-pipeline-metal-swift/1.jpg" alt="Picture"/>
<img src="/images/blog/setting-up-render-pipeline-metal-swift/2.jpg" alt="Picture"/></p>
<hr/>
<h2 id="mtkview">MTKView</h2>
<ul>
<li><a href="https://developer.apple.com/documentation/metalkit/mtkview">MTK View</a></li>
</ul>
<p>Create a new <strong>Cocoa Class</strong> file, extending from <strong>MTKView</strong>, which in turn extends <strong>NSView</strong>.</p>
<p>This will be connected to your main <strong>Storyboard</strong> for the <strong>Game View</strong>, where we will output the rendering of the pipeline.</p>
<p><img src="/images/blog/setting-up-render-pipeline-metal-swift/3.jpg" alt="Picture"/>
<img src="/images/blog/setting-up-render-pipeline-metal-swift/4.jpg" alt="Picture"/>
<img src="/images/blog/setting-up-render-pipeline-metal-swift/5.jpg" alt="Picture"/></p>
<hr/>
<h2 id="the-command-structure">The Command Structure</h2>
<p><a href="https://developer.apple.com/documentation/metal/gpu_devices_and_work_submission/setting_up_a_command_structure">Command Structure Images from Apple Docs</a></p>
<p>The <strong>Metal</strong> Graphics <strong>API</strong> uses a <strong>Command Structure</strong> to handle all the petitions from the <strong>CPU</strong> to render graphics in the <strong>GPU</strong>.</p>
<p><img src="/images/blog/setting-up-render-pipeline-metal-swift/6.png" alt="Picture"/>
<img src="/images/blog/setting-up-render-pipeline-metal-swift/9.jpg" alt="Picture"/></p>
<p><a href="https://lcellentani.github.io/post/metal_introduction/">Render Pipeline Descriptor Image Source</a></p>
<p>The <strong>Command Buffers</strong> contain the instructions the the <strong>CPU</strong> needs to execute.
<img src="/images/blog/setting-up-render-pipeline-metal-swift/7.png" alt="Picture"/></p>
<p>The <strong>Command Queue</strong> holds all the <strong>Command Buffers</strong> and ensures they execute timely and in order. It also handles executions and results coming to/from <strong>Compute Shaders</strong>.
<img src="/images/blog/setting-up-render-pipeline-metal-swift/8.png" alt="Picture"/></p>
<h3 id="resources">Resources</h3>
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/metal/using_a_render_pipeline_to_render_primitives">Metal Render Pipeline</a></p>
<ul>
<li><a href="https://lcellentani.github.io/post/metal_introduction/">Introduction to Metal by Ludovico Cellentani</a></li>
</ul>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/metal/gpu_devices_and_work_submission/setting_up_a_command_structure">Setting up a Command Structure</a></p>
<ul>
<li><a href="https://developer.apple.com/documentation/metal/mtlcommandbuffer">MTL Command Buffer</a></li>
<li><a href="https://developer.apple.com/documentation/metal/mtlcommandencoder">MTL Command Encoder</a>
<ul>
<li><a href="https://developer.apple.com/documentation/metal/mtlrendercommandencoder">MTL Render Command Encoder</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/metal/mtlrenderpassdescriptor">MTL Render Pass Descriptor</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/metal/mtlrenderpipelinestate">MTL Render Pipeline State</a></p>
<ul>
<li><a href="https://developer.apple.com/documentation/metal/mtlrenderpipelinedescriptor">MTL Render Pipeline Descriptor</a>
<ul>
<li>Color Attachments<!-- -->
<ul>
<li>Pixel Format</li>
</ul>
</li>
<li>Vertex/Fragment Functions<!-- -->
<ul>
<li><a href="https://developer.apple.com/documentation/metal/mtllibrary">MTL Library</a>
<ul>
<li><a href="https://developer.apple.com/documentation/metal/mtlfunctiontype">MTL Function Type</a>
<ul>
<li>Vertex/Fragment/Kernel</li>
</ul>
</li>
<li><a href="https://developer.apple.com/documentation/metal/mtlfunction">MTL Function</a>
<ul>
<li><strong>.metal</strong> files</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/metal/mtldevice">MTL Device</a></p>
<ul>
<li><a href="https://developer.apple.com/documentation/metal/mtlpixelformat">MTL Pixel Format</a></li>
<li><a href="https://developer.apple.com/documentation/metal/mtlcommandqueue">MTL Command Queue</a></li>
</ul>
</li>
</ul>
<hr/>
<h2 id="basic-render-pipeline">Basic Render Pipeline</h2>
<ol>
<li>The <strong>Device</strong> represents the <strong>GPU</strong> device in the machine.</li>
<li>From the <strong>Device</strong>, we create the <strong>Commmand Queue</strong>.</li>
<li>We create <strong>Command Buffers</strong> using the <strong>Command Queue</strong>.</li>
<li>The <strong>Render Command Encoder</strong> is created out of the <strong>Command Buffer</strong> (There are many types of <strong>Command Encoders</strong>, <strong>Render</strong> is for Graphics Rendering, <strong>Compute</strong> would be for Computations, as in Compute Shaders)<!-- -->
<ol>
<li>We use the <strong>Render Pass Descriptor</strong> for this, which includes information about the output buffers to show the result of the rendering.</li>
</ol>
</li>
<li>At one point we will set the <strong>Render Pipeline State</strong> to the <strong>Render Command Encoder</strong>.</li>
<li>To create the <strong>Render Pipeline State</strong>, we first need to create the <strong>Render Pipeline Descriptor</strong>.<!-- -->
<ol>
<li>For creating the <strong>Render Pipeline Descriptor</strong>, we need to create a <strong>Library</strong> first, which will let us create the <strong>Functions</strong> for <strong>Vertex</strong> and <strong>Fragment</strong> calculations.</li>
<li>Once we have the <strong>Library</strong> and the <strong>Functions</strong>, we can create the <strong>Render Pipeline Descriptor</strong>.</li>
<li>With the <strong>Render Pipeline Descriptor</strong>, we can tell the <strong>Device</strong> to create the <strong>Render Pipeline State</strong>.</li>
</ol>
</li>
<li>Now we can set the <strong>Render Pipeline State</strong> to the <strong>Render Command Encoder</strong>.</li>
<li>And we can tell the <strong>Command Buffer</strong> to <strong>endEncoding()</strong>, <strong>present()</strong> to the <strong>drawable</strong>, and <strong>commit()</strong> to schedule its execution.</li>
</ol>
<h3 id="code">Code</h3>
<h4 id="shaders">Shaders</h4>
<p>For defining the <strong>Shaders</strong>, we need to create a <strong>Metal</strong> file.</p>
<p><img src="/images/blog/setting-up-render-pipeline-metal-swift/10.jpg" alt="Picture"/>
<img src="/images/blog/setting-up-render-pipeline-metal-swift/11.jpg" alt="Picture"/></p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-c" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span style="color:#1f7199">#</span><span style="color:#1f7199;font-weight:bold">include</span><span style="color:#1f7199"> </span><span style="color:#4d99bf">&lt;metal_stdlib&gt;</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span></span><span style="font-weight:bold">using</span><span> </span><span style="font-weight:bold">namespace</span><span> metal;
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span></span><span class="hljs-function">vertex float4 </span><span class="hljs-function" style="color:#880000;font-weight:bold">basic_vertex_shader</span><span class="hljs-function hljs-params">()</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>    </span><span style="font-weight:bold">return</span><span> float4(</span><span style="color:#880000">1</span><span>);
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span>}
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span></span><span class="hljs-function">fragment half4 </span><span class="hljs-function" style="color:#880000;font-weight:bold">basic_fragment_shader</span><span class="hljs-function hljs-params">()</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>    </span><span style="font-weight:bold">return</span><span> half4(</span><span style="color:#880000">1</span><span>);
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>}</code></div></pre>
<h4 id="game-view">Game View</h4>
<p>For now this will just clear the screen with a basic green color, every frame.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span style="font-weight:bold">import</span><span> MetalKit
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span><span></span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">GameView</span><span class="hljs-class">: </span><span class="hljs-class" style="color:#880000;font-weight:bold">MTKView</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>    </span><span style="font-weight:bold">var</span><span> commandQueue: </span><span style="color:#880000">MTLCommandQueue</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>    </span><span style="font-weight:bold">var</span><span> renderPipelineState: </span><span style="color:#880000">MTLRenderPipelineState</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span><span>    </span><span style="font-weight:bold">required</span><span> </span><span class="hljs-function" style="font-weight:bold">init</span><span class="hljs-function">(</span><span class="hljs-function hljs-params">coder</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">NSCoder</span><span class="hljs-function">)</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>        </span><span style="font-weight:bold">super</span><span>.</span><span style="font-weight:bold">init</span><span>(coder: coder)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>        </span><span style="color:#888888">// device is an abstract representation of the GPU</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span><span>        </span><span style="color:#888888">// allows to create Metal GPU objects and send them down to the GPU</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span><span>        </span><span style="font-weight:bold">self</span><span>.device </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MTLCreateSystemDefaultDevice</span><span>()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span><span>        </span><span style="color:#888888">// clearColor fills the screen each time the GPU clears the frame (60 times per second at 60 fps)</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span><span>        </span><span style="color:#888888">// rgba is 0-1</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">17</span><span>        </span><span style="font-weight:bold">self</span><span>.clearColor </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MTLClearColor</span><span>(red: </span><span style="color:#880000">0.43</span><span>, green: </span><span style="color:#880000">0.73</span><span>, blue: </span><span style="color:#880000">0.35</span><span>, alpha: </span><span style="color:#880000">1.0</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">18</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">19</span><span>        </span><span style="color:#888888">// how pixels are stored</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">20</span><span>        </span><span style="font-weight:bold">self</span><span>.colorPixelFormat </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MTLPixelFormat</span><span>.bgra8Unorm
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">21</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">22</span><span>        </span><span style="color:#888888">// create the command queue to handle commands for the GPU</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">23</span><span>        </span><span style="font-weight:bold">self</span><span>.commandQueue </span><span class="hljs-operator">=</span><span> device</span><span class="hljs-operator">?</span><span>.makeCommandQueue()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">24</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">25</span>        createRenderPipelineState()
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">26</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">27</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">28</span><span>    </span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">createRenderPipelineState</span><span class="hljs-function">()</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">29</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">30</span><span>        </span><span style="font-weight:bold">let</span><span> library </span><span class="hljs-operator">=</span><span> device</span><span class="hljs-operator">?</span><span>.makeDefaultLibrary()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">31</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">32</span><span>        </span><span style="color:#888888">// at compile time it will pick the right vertex and shader functions by matching the names</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">33</span><span>        </span><span style="font-weight:bold">let</span><span> vertexFunction </span><span class="hljs-operator">=</span><span> library</span><span class="hljs-operator">?</span><span>.makeFunction(name: </span><span style="color:#880000">&quot;basic_vertex_shader&quot;</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">34</span><span>        </span><span style="font-weight:bold">let</span><span> fragmentFunction </span><span class="hljs-operator">=</span><span> library</span><span class="hljs-operator">?</span><span>.makeFunction(name: </span><span style="color:#880000">&quot;basic_fragment_shader&quot;</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">35</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">36</span><span>        </span><span style="color:#888888">// create the descriptor for the render pipeline, make the pixel format match the device</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">37</span><span>        </span><span style="font-weight:bold">let</span><span> renderPipelineDescriptor </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MTLRenderPipelineDescriptor</span><span>()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">38</span><span>        renderPipelineDescriptor.colorAttachments[</span><span style="color:#880000">0</span><span>].pixelFormat </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MTLPixelFormat</span><span>.bgra8Unorm
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">39</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">40</span><span>        </span><span style="color:#888888">// set the vertex and fragment functions</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">41</span><span>        renderPipelineDescriptor.vertexFunction </span><span class="hljs-operator">=</span><span> vertexFunction
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">42</span><span>        renderPipelineDescriptor.fragmentFunction </span><span class="hljs-operator">=</span><span> fragmentFunction
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">43</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">44</span><span>        </span><span style="color:#888888">// create the render pipeline state using the render pipeline descriptor</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">45</span><span>        </span><span style="font-weight:bold">do</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">46</span><span>            renderPipelineState </span><span class="hljs-operator">=</span><span> </span><span style="font-weight:bold">try</span><span> device</span><span class="hljs-operator">?</span><span>.makeRenderPipelineState(descriptor: renderPipelineDescriptor)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">47</span><span>        } </span><span style="font-weight:bold">catch</span><span> </span><span style="font-weight:bold">let</span><span> error </span><span style="font-weight:bold">as</span><span> </span><span style="color:#880000">NSError</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">48</span><span>            </span><span style="color:#397300">print</span><span>(error)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">49</span>        }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">50</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">51</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">52</span><span>    </span><span style="font-weight:bold">override</span><span> </span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">draw</span><span class="hljs-function">(</span><span class="hljs-function" style="font-weight:bold">_</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">dirtyRect</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">NSRect</span><span class="hljs-function">)</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">53</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">54</span><span>        </span><span style="color:#888888">// get references if available, else return</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">55</span><span>        </span><span style="font-weight:bold">guard</span><span> </span><span style="font-weight:bold">let</span><span> drawable </span><span class="hljs-operator">=</span><span> </span><span style="font-weight:bold">self</span><span>.currentDrawable, </span><span style="font-weight:bold">let</span><span> renderPassDescriptor </span><span class="hljs-operator">=</span><span> </span><span style="font-weight:bold">self</span><span>.currentRenderPassDescriptor </span><span style="font-weight:bold">else</span><span> { </span><span style="font-weight:bold">return</span><span> }
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">56</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">57</span><span>        </span><span style="color:#888888">// cretae a command buffer</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">58</span><span>        </span><span style="font-weight:bold">let</span><span> commandBuffer </span><span class="hljs-operator">=</span><span> commandQueue.makeCommandBuffer()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">59</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">60</span><span>        </span><span style="color:#888888">// create the render command encoder</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">61</span><span>        </span><span style="color:#888888">// pass the render pass descriptor, which includes pixel information and destination buffers</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">62</span><span>        </span><span style="font-weight:bold">let</span><span> renderCommandEncoder </span><span class="hljs-operator">=</span><span> commandBuffer</span><span class="hljs-operator">?</span><span>.makeRenderCommandEncoder(descriptor: renderPassDescriptor)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">63</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">64</span><span>        </span><span style="color:#888888">// set the render pipeline state to the render command encoder</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">65</span><span>        renderCommandEncoder</span><span class="hljs-operator">?</span><span>.setRenderPipelineState(</span><span style="font-weight:bold">self</span><span>.renderPipelineState)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">66</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">67</span><span>        </span><span style="color:#888888">// </span><span style="color:#888888;font-weight:bold">TODO:</span><span style="color:#888888"> send info to render command encoder</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">68</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">69</span><span>        </span><span style="color:#888888">// after passing all the data</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">70</span><span>        renderCommandEncoder</span><span class="hljs-operator">?</span><span>.endEncoding()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">71</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">72</span><span>        </span><span style="color:#888888">// the command buffer will present the result of the rendering when it&#x27;s done</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">73</span><span>        commandBuffer</span><span class="hljs-operator">?</span><span>.present(drawable)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">74</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">75</span><span>        </span><span style="color:#888888">// execute the command buffer</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">76</span><span>        commandBuffer</span><span class="hljs-operator">?</span><span>.commit()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">77</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">78</span>}</code></div></pre>
<h3 id="result">Result</h3>
<p><img src="/images/blog/setting-up-render-pipeline-metal-swift/12.jpg" alt="Picture"/></p></div></article><div style="padding-top:3.5em"></div></main><footer class="Footer_footer__rEL09"><p>¬©<!-- --> 2022, Gonzalo Cumini</p><ul class="Footer_icons__IyNdc"><li class="Footer_icon__mhtwE"><a href="https://linkedin.com/in/gonzacn" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li><li class="Footer_icon__mhtwE"><a href="https://github.com/z4gon" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li></ul></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"setting-up-render-pipeline-metal-swift","date":"2022-11-29T00:00:00.000Z","author":{"name":"Gonzalo Cumini","pictureUrl":"/images/avatars/z4gon.jpg"},"title":"Render Pipeline with Metal and Swift: Part 1","excerpt":"Following the amazing tutorial series by Rick Twohy, creating a basic macos app project in xcode using Swift and Storyboards. Utilizing the Metal Kit library to access the Metal APIs to render 3D graphics, initializing the basic components to setup the render pipeline and start outputing 3D graphics on the screen.","coverImageUrl":"/images/blog/setting-up-render-pipeline-metal-swift/cover.jpg","coverImageSourceUrl":"https://unsplash.com/photos/ICTjWYzpoc0","contentMarkdown":"\n## Source Code\n\n[See Project in GitHub üë©‚Äçüíª](https://github.com/z4gon/metal-render-pipeline)\n\n## References\n\n-   [Metal Render Pipeline tutorial series by Rick Twohy](https://www.youtube.com/playlist?list=PLEXt1-oJUa4BVgjZt9tK2MhV_DW7PVDsg)\n-   [Introduction to Metal by Ludovico Cellentani](https://lcellentani.github.io/post/metal_introduction/)\n\n---\n\n## Table of Content\n\n-   [Creating the XCode project](#creating-the-xcode-project)\n-   [MTKView](#mtkview)\n-   [The Command Structure](#the-command-structure)\n    -   [Resources](#resources)\n-   [Basic Render Pipeline](#basic-render-pipeline)\n    -   [Code](#code)\n        -   [Shaders](#shaders)\n        -   [Game View](#game-view)\n    -   [Result](#result)\n\n---\n\n## Creating the XCode project\n\nWe just need to create a very basic **macOS** app using **Swift** and **Storyboards** for the UI.\n\n![Picture](/images/blog/setting-up-render-pipeline-metal-swift/1.jpg)\n![Picture](/images/blog/setting-up-render-pipeline-metal-swift/2.jpg)\n\n---\n\n## MTKView\n\n-   [MTK View](https://developer.apple.com/documentation/metalkit/mtkview)\n\nCreate a new **Cocoa Class** file, extending from **MTKView**, which in turn extends **NSView**.\n\nThis will be connected to your main **Storyboard** for the **Game View**, where we will output the rendering of the pipeline.\n\n![Picture](/images/blog/setting-up-render-pipeline-metal-swift/3.jpg)\n![Picture](/images/blog/setting-up-render-pipeline-metal-swift/4.jpg)\n![Picture](/images/blog/setting-up-render-pipeline-metal-swift/5.jpg)\n\n---\n\n## The Command Structure\n\n[Command Structure Images from Apple Docs](https://developer.apple.com/documentation/metal/gpu_devices_and_work_submission/setting_up_a_command_structure)\n\nThe **Metal** Graphics **API** uses a **Command Structure** to handle all the petitions from the **CPU** to render graphics in the **GPU**.\n\n![Picture](/images/blog/setting-up-render-pipeline-metal-swift/6.png)\n![Picture](/images/blog/setting-up-render-pipeline-metal-swift/9.jpg)\n\n[Render Pipeline Descriptor Image Source](https://lcellentani.github.io/post/metal_introduction/)\n\nThe **Command Buffers** contain the instructions the the **CPU** needs to execute.\n![Picture](/images/blog/setting-up-render-pipeline-metal-swift/7.png)\n\nThe **Command Queue** holds all the **Command Buffers** and ensures they execute timely and in order. It also handles executions and results coming to/from **Compute Shaders**.\n![Picture](/images/blog/setting-up-render-pipeline-metal-swift/8.png)\n\n### Resources\n\n-   [Metal Render Pipeline](https://developer.apple.com/documentation/metal/using_a_render_pipeline_to_render_primitives)\n\n    -   [Introduction to Metal by Ludovico Cellentani](https://lcellentani.github.io/post/metal_introduction/)\n\n-   [Setting up a Command Structure](https://developer.apple.com/documentation/metal/gpu_devices_and_work_submission/setting_up_a_command_structure)\n    -   [MTL Command Buffer](https://developer.apple.com/documentation/metal/mtlcommandbuffer)\n    -   [MTL Command Encoder](https://developer.apple.com/documentation/metal/mtlcommandencoder)\n        -   [MTL Render Command Encoder](https://developer.apple.com/documentation/metal/mtlrendercommandencoder)\n-   [MTL Render Pass Descriptor](https://developer.apple.com/documentation/metal/mtlrenderpassdescriptor)\n-   [MTL Render Pipeline State](https://developer.apple.com/documentation/metal/mtlrenderpipelinestate)\n\n    -   [MTL Render Pipeline Descriptor](https://developer.apple.com/documentation/metal/mtlrenderpipelinedescriptor)\n        -   Color Attachments\n            -   Pixel Format\n        -   Vertex/Fragment Functions\n            -   [MTL Library](https://developer.apple.com/documentation/metal/mtllibrary)\n                -   [MTL Function Type](https://developer.apple.com/documentation/metal/mtlfunctiontype)\n                    -   Vertex/Fragment/Kernel\n                -   [MTL Function](https://developer.apple.com/documentation/metal/mtlfunction)\n                    -   **.metal** files\n\n-   [MTL Device](https://developer.apple.com/documentation/metal/mtldevice)\n    -   [MTL Pixel Format](https://developer.apple.com/documentation/metal/mtlpixelformat)\n    -   [MTL Command Queue](https://developer.apple.com/documentation/metal/mtlcommandqueue)\n\n---\n\n## Basic Render Pipeline\n\n1. The **Device** represents the **GPU** device in the machine.\n1. From the **Device**, we create the **Commmand Queue**.\n1. We create **Command Buffers** using the **Command Queue**.\n1. The **Render Command Encoder** is created out of the **Command Buffer** (There are many types of **Command Encoders**, **Render** is for Graphics Rendering, **Compute** would be for Computations, as in Compute Shaders)\n    1. We use the **Render Pass Descriptor** for this, which includes information about the output buffers to show the result of the rendering.\n1. At one point we will set the **Render Pipeline State** to the **Render Command Encoder**.\n1. To create the **Render Pipeline State**, we first need to create the **Render Pipeline Descriptor**.\n    1. For creating the **Render Pipeline Descriptor**, we need to create a **Library** first, which will let us create the **Functions** for **Vertex** and **Fragment** calculations.\n    2. Once we have the **Library** and the **Functions**, we can create the **Render Pipeline Descriptor**.\n    3. With the **Render Pipeline Descriptor**, we can tell the **Device** to create the **Render Pipeline State**.\n1. Now we can set the **Render Pipeline State** to the **Render Command Encoder**.\n1. And we can tell the **Command Buffer** to **endEncoding()**, **present()** to the **drawable**, and **commit()** to schedule its execution.\n\n### Code\n\n#### Shaders\n\nFor defining the **Shaders**, we need to create a **Metal** file.\n\n![Picture](/images/blog/setting-up-render-pipeline-metal-swift/10.jpg)\n![Picture](/images/blog/setting-up-render-pipeline-metal-swift/11.jpg)\n\n```c\n#include \u003cmetal_stdlib\u003e\nusing namespace metal;\n\nvertex float4 basic_vertex_shader(){\n    return float4(1);\n}\n\nfragment half4 basic_fragment_shader(){\n    return half4(1);\n}\n```\n\n#### Game View\n\nFor now this will just clear the screen with a basic green color, every frame.\n\n```swift\nimport MetalKit\n\nclass GameView: MTKView {\n\n    var commandQueue: MTLCommandQueue!\n    var renderPipelineState: MTLRenderPipelineState!\n\n    required init(coder: NSCoder) {\n        super.init(coder: coder)\n\n        // device is an abstract representation of the GPU\n        // allows to create Metal GPU objects and send them down to the GPU\n        self.device = MTLCreateSystemDefaultDevice()\n\n        // clearColor fills the screen each time the GPU clears the frame (60 times per second at 60 fps)\n        // rgba is 0-1\n        self.clearColor = MTLClearColor(red: 0.43, green: 0.73, blue: 0.35, alpha: 1.0)\n\n        // how pixels are stored\n        self.colorPixelFormat = MTLPixelFormat.bgra8Unorm\n\n        // create the command queue to handle commands for the GPU\n        self.commandQueue = device?.makeCommandQueue()\n\n        createRenderPipelineState()\n    }\n\n    func createRenderPipelineState(){\n\n        let library = device?.makeDefaultLibrary()\n\n        // at compile time it will pick the right vertex and shader functions by matching the names\n        let vertexFunction = library?.makeFunction(name: \"basic_vertex_shader\")\n        let fragmentFunction = library?.makeFunction(name: \"basic_fragment_shader\")\n\n        // create the descriptor for the render pipeline, make the pixel format match the device\n        let renderPipelineDescriptor = MTLRenderPipelineDescriptor()\n        renderPipelineDescriptor.colorAttachments[0].pixelFormat = MTLPixelFormat.bgra8Unorm\n\n        // set the vertex and fragment functions\n        renderPipelineDescriptor.vertexFunction = vertexFunction\n        renderPipelineDescriptor.fragmentFunction = fragmentFunction\n\n        // create the render pipeline state using the render pipeline descriptor\n        do {\n            renderPipelineState = try device?.makeRenderPipelineState(descriptor: renderPipelineDescriptor)\n        } catch let error as NSError {\n            print(error)\n        }\n    }\n\n    override func draw(_ dirtyRect: NSRect) {\n\n        // get references if available, else return\n        guard let drawable = self.currentDrawable, let renderPassDescriptor = self.currentRenderPassDescriptor else { return }\n\n        // cretae a command buffer\n        let commandBuffer = commandQueue.makeCommandBuffer()\n\n        // create the render command encoder\n        // pass the render pass descriptor, which includes pixel information and destination buffers\n        let renderCommandEncoder = commandBuffer?.makeRenderCommandEncoder(descriptor: renderPassDescriptor)\n\n        // set the render pipeline state to the render command encoder\n        renderCommandEncoder?.setRenderPipelineState(self.renderPipelineState)\n\n        // TODO: send info to render command encoder\n\n        // after passing all the data\n        renderCommandEncoder?.endEncoding()\n\n        // the command buffer will present the result of the rendering when it's done\n        commandBuffer?.present(drawable)\n\n        // execute the command buffer\n        commandBuffer?.commit()\n    }\n}\n```\n\n### Result\n\n![Picture](/images/blog/setting-up-render-pipeline-metal-swift/12.jpg)\n"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"setting-up-render-pipeline-metal-swift"},"buildId":"LJ98T7ogm-aKp4icEWbaC","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>