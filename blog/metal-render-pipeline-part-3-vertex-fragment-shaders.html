<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Metal Render Pipeline Part 3: Vertex and Fragment Shaders</title><meta name="title" content="Metal Render Pipeline Part 3: Vertex and Fragment Shaders"/><meta name="description" content="Modeling the vertices data as structs in the CPU side, then passing this data through a buffer to the GPU. Modeling the data structures for vertex and fragment functions in the GPU side. Accessing the interpolated values after rasterization to render corresponding colors for pixels on screen."/><meta property="og:type" content="website"/><meta property="og:url" content="https://z4gon.github.io/blog/metal-render-pipeline-part-3-vertex-fragment-shaders"/><meta property="og:title" content="Metal Render Pipeline Part 3: Vertex and Fragment Shaders"/><meta property="og:description" content="Modeling the vertices data as structs in the CPU side, then passing this data through a buffer to the GPU. Modeling the data structures for vertex and fragment functions in the GPU side. Accessing the interpolated values after rasterization to render corresponding colors for pixels on screen."/><meta property="og:image" content="https://z4gon.github.io/images/blog/metal-render-pipeline-part-3-vertex-fragment-shaders/cover.jpg"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:url" content="https://z4gon.github.io/blog/metal-render-pipeline-part-3-vertex-fragment-shaders"/><meta property="twitter:title" content="Metal Render Pipeline Part 3: Vertex and Fragment Shaders"/><meta property="twitter:description" content="Modeling the vertices data as structs in the CPU side, then passing this data through a buffer to the GPU. Modeling the data structures for vertex and fragment functions in the GPU side. Accessing the interpolated values after rasterization to render corresponding colors for pixels on screen."/><meta property="twitter:image" content="https://z4gon.github.io/images/blog/metal-render-pipeline-part-3-vertex-fragment-shaders/cover.jpg"/><link rel="icon" href="https://z4gon.github.io/favicon.ico"/><link rel="canonical" href="https://z4gon.github.io/blog/metal-render-pipeline-part-3-vertex-fragment-shaders"/><meta name="next-head-count" content="17"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/1bfb3b4d6930f464.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1bfb3b4d6930f464.css" data-n-g=""/><link rel="preload" href="/_next/static/css/7f11fd614ca16a3e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7f11fd614ca16a3e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-38cee4c0e358b1a3.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-f11614d8aa7ee555.js" defer=""></script><script src="/_next/static/chunks/pages/_app-a7128038526bd4a3.js" defer=""></script><script src="/_next/static/chunks/151-d7aafd1408876fb7.js" defer=""></script><script src="/_next/static/chunks/358-14c60bb94e9d94b9.js" defer=""></script><script src="/_next/static/chunks/895-5e9231f11f5aa57f.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-71753cea0aef4a44.js" defer=""></script><script src="/_next/static/dySdq6Xb0NnqayZdO7C_6/_buildManifest.js" defer=""></script><script src="/_next/static/dySdq6Xb0NnqayZdO7C_6/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,500;0,700;1,300;1,500&display=swap">@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memQYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWq8tWZ0Pw86hd0Rk5hkaVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memQYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWq8tWZ0Pw86hd0Rk_RkaVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsiH0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjr0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsg-1y4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtE6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWvU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWu06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWt06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuU6FxZCJgg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtE6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWvU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWu06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWt06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuU6FxZCJgg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="Page_page__0A7TG"><nav class="NavBar_navbar__W8B89"><ul class="NavBar_links__s6P8N"><li><a class="NavBar_titleLink__OtPh0" href="/"><h1>Gonzalo Cumini</h1></a></li><li class="NavBar_secondaryLink__TpgXh"><a href="/"><h1>Portfolio</h1></a></li><li class="NavBar_secondaryLink__TpgXh"><a href="/blog"><h1>Blog</h1></a></li></ul><ul class="NavBar_icons__Q_6kO"><li class="NavBar_icon__MjYq8"><a href="https://linkedin.com/in/gonzacn" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li><li class="NavBar_icon__MjYq8"><a href="https://github.com/z4gon" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li></ul></nav><main class="Container_container__B4HQR Container_narrow__Miio9"><div style="padding-top:3.5em"></div><article><div class="PostHeader_postHeader__aw96i"><h1 class="PostTitle_postTitle__oD_V4">Metal Render Pipeline Part 3: Vertex and Fragment Shaders</h1><div class="PostHeader_authorAndDate__tbJVE"><div class="Avatar_avatar__G9F0L"><img src="/images/avatars/z4gon.jpg" alt="Gonzalo Cumini"/><div class="Avatar_name__yGpBe">Gonzalo Cumini</div></div><time class="DateFormatter_dateFormatter__UBCZJ" dateTime="2022-12-01T00:00:00.000Z">December	1, 2022</time></div><div class="CoverImage_coverImage__lFFCh"><img src="/images/blog/metal-render-pipeline-part-3-vertex-fragment-shaders/cover.jpg" alt="Cover Image for Metal Render Pipeline Part 3: Vertex and Fragment Shaders"/></div></div><div class="MarkdownContent_markdownContent__TdwXL"><h2 id="source-code">Source Code</h2>
<p><a href="https://github.com/z4gon/metal-render-pipeline">See Project in GitHub 👩‍💻</a></p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.youtube.com/playlist?list=PLEXt1-oJUa4BVgjZt9tK2MhV_DW7PVDsg">Metal Render Pipeline tutorial series by Rick Twohy</a></li>
<li><a href="https://developer.apple.com/documentation/metal/using_a_render_pipeline_to_render_primitives">Using a Render Pipeline to Render Primitives</a></li>
</ul>
<hr/>
<h2 id="table-of-content">Table of Content</h2>
<ul>
<li><a href="#vertex-struct">Vertex Struct in CPU</a></li>
<li><a href="#vertex-shader">Vertex Shader</a></li>
<li><a href="#fragment-shader">Fragment Shader</a></li>
<li><a href="#result">Result</a></li>
</ul>
<hr/>
<h2 id="vertex-struct-in-cpu">Vertex Struct in CPU</h2>
<p>We will expand the data definition for the vertices, including not only the <strong>position</strong> in <strong>screen space</strong>, but also the <strong>color</strong> of the vertices.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">struct</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">Vertex</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>    </span><span style="font-weight:bold">var</span><span> position: </span><span style="color:#880000">SIMD3</span><span>&lt;</span><span style="color:#880000">Float</span><span>&gt;
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span style="font-weight:bold">var</span><span> color: </span><span style="color:#880000">SIMD4</span><span>&lt;</span><span style="color:#880000">Float</span><span>&gt;
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span>}</code></div></pre>
<p><img src="/images/blog/metal-render-pipeline-part-3-vertex-fragment-shaders/2.png" alt="Picture"/></p>
<p><a href="https://developer.apple.com/documentation/metal/using_a_render_pipeline_to_render_primitives">Image Source 🔗</a></p>
<p>The vertices array now holds objects of this type, and we also need to account for this when calculating the <strong>memory stride</strong>.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">1</span><span style="font-weight:bold">var</span><span> vertices: [</span><span style="color:#880000">Vertex</span><span>]</span><span class="hljs-operator">!</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">3</span><span></span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">createVertices</span><span class="hljs-function">()</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>    </span><span style="color:#888888">// counter clock wise to define the face</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>    vertices </span><span class="hljs-operator">=</span><span> [
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>        </span><span style="color:#880000">Vertex</span><span>(position: </span><span style="color:#880000">SIMD3</span><span>&lt;</span><span style="color:#880000">Float</span><span>&gt;(</span><span style="color:#880000">0</span><span>, </span><span style="color:#880000">1</span><span>, </span><span style="color:#880000">0</span><span>),   color: </span><span style="color:#880000">SIMD4</span><span>&lt;</span><span style="color:#880000">Float</span><span>&gt;(</span><span style="color:#880000">0</span><span>, </span><span style="color:#880000">0</span><span>, </span><span style="color:#880000">1</span><span>, </span><span style="color:#880000">1</span><span>)), </span><span style="color:#888888">// top mid</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>        </span><span style="color:#880000">Vertex</span><span>(position: </span><span style="color:#880000">SIMD3</span><span>&lt;</span><span style="color:#880000">Float</span><span>&gt;(</span><span class="hljs-operator">-</span><span style="color:#880000">1</span><span>, </span><span class="hljs-operator">-</span><span style="color:#880000">1</span><span>, </span><span style="color:#880000">0</span><span>), color: </span><span style="color:#880000">SIMD4</span><span>&lt;</span><span style="color:#880000">Float</span><span>&gt;(</span><span style="color:#880000">0</span><span>, </span><span style="color:#880000">1</span><span>, </span><span style="color:#880000">0</span><span>, </span><span style="color:#880000">1</span><span>)), </span><span style="color:#888888">// bot left</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">8</span><span>        </span><span style="color:#880000">Vertex</span><span>(position: </span><span style="color:#880000">SIMD3</span><span>&lt;</span><span style="color:#880000">Float</span><span>&gt;(</span><span style="color:#880000">1</span><span>, </span><span class="hljs-operator">-</span><span style="color:#880000">1</span><span>, </span><span style="color:#880000">0</span><span>),  color: </span><span style="color:#880000">SIMD4</span><span>&lt;</span><span style="color:#880000">Float</span><span>&gt;(</span><span style="color:#880000">1</span><span>, </span><span style="color:#880000">0</span><span>, </span><span style="color:#880000">0</span><span>, </span><span style="color:#880000">1</span><span>)), </span><span style="color:#888888">// top right</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">9</span>    ]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">10</span>}
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">11</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">12</span><span></span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">createBuffers</span><span class="hljs-function">()</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">13</span><span>    </span><span style="font-weight:bold">let</span><span> vertexMemSize </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MemoryLayout</span><span>&lt;</span><span style="color:#880000">Vertex</span><span>&gt;.stride
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">14</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">15</span><span>    vertexBuffer </span><span class="hljs-operator">=</span><span> device</span><span class="hljs-operator">?</span><span>.makeBuffer(bytes: vertices, length: vertexMemSize </span><span class="hljs-operator">*</span><span> vertices.count, options: [])
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none">16</span>}</code></div></pre>
<hr/>
<h2 id="vertex-shader">Vertex Shader</h2>
<p>Similarly, in the <strong>GPU side</strong>, we need to <strong>model the data</strong> with the <strong>closest data types</strong>.
We will read elements off of the buffer, and will represent them with these structures.</p>
<p>The attribute <code>[[ position ]]</code> prevents the values interpolation from happening on it. <strong>Color</strong> will be <strong>interpolated</strong> <strong>per fragment</strong>, depending on its position in the triangle face, respect to the defining vertices.</p>
<p>The interpolation happens at the <strong>Rasterizer</strong> stage.</p>
<p><img src="/images/blog/metal-render-pipeline-part-3-vertex-fragment-shaders/3.png" alt="Picture"/></p>
<p><a href="https://developer.apple.com/documentation/metal/using_a_render_pipeline_to_render_primitives">Image Source 🔗</a></p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">struct</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">VertexData</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span>    float3 position;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span>    float4 color;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span>};
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span><span></span><span class="hljs-class" style="font-weight:bold">struct</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">FragmentData</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>    float4 position [[ position ]]; </span><span style="color:#888888">// use position attribute to prevent interpolation of the value</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">8</span>    float4 color;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">9</span>};</code></div></pre>
<p>Now the <strong>vertex funciton</strong> takes in an array of <strong>VertexData</strong>.</p>
<p>We also need to create a new <strong>FragmentData</strong> structure and populate it with the corresponding values.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>vertex </span><span style="color:#880000">FragmentData</span><span> basic_vertex_shader(
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>  device </span><span style="color:#880000">VertexData</span><span> </span><span class="hljs-operator">*</span><span>vertices [[ buffer(</span><span style="color:#880000">0</span><span>) ]], </span><span style="color:#888888">// access the vertices buffer at buffer with index 0</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>  uint vertexID [[ vertex_id ]] </span><span style="color:#888888">// get the vertex id, which corresponds to the index of the vertex in the buffer</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span>){
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>    </span><span style="color:#880000">VertexData</span><span> </span><span style="color:#880000">IN</span><span> </span><span class="hljs-operator">=</span><span> vertices[vertexID];
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>    </span><span style="color:#880000">FragmentData</span><span> </span><span style="color:#880000">OUT</span><span>;
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>    </span><span style="color:#880000">OUT</span><span>.position </span><span class="hljs-operator">=</span><span> float4(</span><span style="color:#880000">IN</span><span>.position, </span><span style="color:#880000">1</span><span>); </span><span style="color:#888888">// return the vertex position in homogeneous screen space</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span><span>    </span><span style="color:#880000">OUT</span><span>.color </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">IN</span><span>.color;
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span>    </span><span style="font-weight:bold">return</span><span> </span><span style="color:#880000">OUT</span><span>; </span><span style="color:#888888">// return the vertex position in homogeneous screen space</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>}</code></div></pre>
<p><img src="/images/blog/metal-render-pipeline-part-3-vertex-fragment-shaders/4.png" alt="Picture"/></p>
<p><a href="https://developer.apple.com/documentation/metal/using_a_render_pipeline_to_render_primitives">Image Source 🔗</a></p>
<hr/>
<h2 id="fragment-shader">Fragment Shader</h2>
<p>The <strong>fragment function</strong> now takes in a <strong>FragmentData</strong> structure.</p>
<p>We get an <strong>interpolated color</strong> coming in, which we can use to paint the corresponding pixel.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>fragment half4 basic_fragment_shader(</span><span style="color:#880000">FragmentData</span><span> </span><span style="color:#880000">IN</span><span> [[ stage_in ]]){
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>    float4 color </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">IN</span><span>.color;
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span style="font-weight:bold">return</span><span> half4(color.r, color.g, color.b, color.a);
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span>}</code></div></pre>
<p><img src="/images/blog/metal-render-pipeline-part-3-vertex-fragment-shaders/5.png" alt="Picture"/></p>
<p><a href="https://developer.apple.com/documentation/metal/using_a_render_pipeline_to_render_primitives">Image Source 🔗</a></p>
<hr/>
<h2 id="result">Result</h2>
<p><img src="/images/blog/metal-render-pipeline-part-3-vertex-fragment-shaders/cover.jpg" alt="Picture"/></p></div></article><div style="padding-top:3.5em"></div></main><footer class="Footer_footer__rEL09"><p>©<!-- --> 2023, Gonzalo Cumini</p><ul class="Footer_icons__IyNdc"><li class="Footer_icon__mhtwE"><a href="https://linkedin.com/in/gonzacn" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li><li class="Footer_icon__mhtwE"><a href="https://github.com/z4gon" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li></ul></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"metal-render-pipeline-part-3-vertex-fragment-shaders","date":"2022-12-01T00:00:00.000Z","author":{"name":"Gonzalo Cumini","pictureUrl":"/images/avatars/z4gon.jpg"},"title":"Metal Render Pipeline Part 3: Vertex and Fragment Shaders","excerpt":"Modeling the vertices data as structs in the CPU side, then passing this data through a buffer to the GPU. Modeling the data structures for vertex and fragment functions in the GPU side. Accessing the interpolated values after rasterization to render corresponding colors for pixels on screen.","coverImageUrl":"/images/blog/metal-render-pipeline-part-3-vertex-fragment-shaders/cover.jpg","coverImageSourceUrl":"","coverVideoUrl":"","markdownContent":"\n## Source Code\n\n[See Project in GitHub 👩‍💻](https://github.com/z4gon/metal-render-pipeline)\n\n## References\n\n- [Metal Render Pipeline tutorial series by Rick Twohy](https://www.youtube.com/playlist?list=PLEXt1-oJUa4BVgjZt9tK2MhV_DW7PVDsg)\n- [Using a Render Pipeline to Render Primitives](https://developer.apple.com/documentation/metal/using_a_render_pipeline_to_render_primitives)\n\n---\n\n## Table of Content\n\n- [Vertex Struct in CPU](#vertex-struct)\n- [Vertex Shader](#vertex-shader)\n- [Fragment Shader](#fragment-shader)\n- [Result](#result)\n\n---\n\n## Vertex Struct in CPU\n\nWe will expand the data definition for the vertices, including not only the **position** in **screen space**, but also the **color** of the vertices.\n\n```swift\nstruct Vertex {\n    var position: SIMD3\u003cFloat\u003e\n    var color: SIMD4\u003cFloat\u003e\n}\n```\n\n![Picture](/images/blog/metal-render-pipeline-part-3-vertex-fragment-shaders/2.png)\n\n[Image Source 🔗](https://developer.apple.com/documentation/metal/using_a_render_pipeline_to_render_primitives)\n\nThe vertices array now holds objects of this type, and we also need to account for this when calculating the **memory stride**.\n\n```swift\nvar vertices: [Vertex]!\n\nfunc createVertices() {\n    // counter clock wise to define the face\n    vertices = [\n        Vertex(position: SIMD3\u003cFloat\u003e(0, 1, 0),   color: SIMD4\u003cFloat\u003e(0, 0, 1, 1)), // top mid\n        Vertex(position: SIMD3\u003cFloat\u003e(-1, -1, 0), color: SIMD4\u003cFloat\u003e(0, 1, 0, 1)), // bot left\n        Vertex(position: SIMD3\u003cFloat\u003e(1, -1, 0),  color: SIMD4\u003cFloat\u003e(1, 0, 0, 1)), // top right\n    ]\n}\n\nfunc createBuffers() {\n    let vertexMemSize = MemoryLayout\u003cVertex\u003e.stride\n\n    vertexBuffer = device?.makeBuffer(bytes: vertices, length: vertexMemSize * vertices.count, options: [])\n}\n```\n\n---\n\n## Vertex Shader\n\nSimilarly, in the **GPU side**, we need to **model the data** with the **closest data types**.\nWe will read elements off of the buffer, and will represent them with these structures.\n\nThe attribute `[[ position ]]` prevents the values interpolation from happening on it. **Color** will be **interpolated** **per fragment**, depending on its position in the triangle face, respect to the defining vertices.\n\nThe interpolation happens at the **Rasterizer** stage.\n\n![Picture](/images/blog/metal-render-pipeline-part-3-vertex-fragment-shaders/3.png)\n\n[Image Source 🔗](https://developer.apple.com/documentation/metal/using_a_render_pipeline_to_render_primitives)\n\n```swift\nstruct VertexData {\n    float3 position;\n    float4 color;\n};\n\nstruct FragmentData {\n    float4 position [[ position ]]; // use position attribute to prevent interpolation of the value\n    float4 color;\n};\n```\n\nNow the **vertex funciton** takes in an array of **VertexData**.\n\nWe also need to create a new **FragmentData** structure and populate it with the corresponding values.\n\n```swift\nvertex FragmentData basic_vertex_shader(\n  device VertexData *vertices [[ buffer(0) ]], // access the vertices buffer at buffer with index 0\n  uint vertexID [[ vertex_id ]] // get the vertex id, which corresponds to the index of the vertex in the buffer\n){\n    VertexData IN = vertices[vertexID];\n\n    FragmentData OUT;\n\n    OUT.position = float4(IN.position, 1); // return the vertex position in homogeneous screen space\n    OUT.color = IN.color;\n\n    return OUT; // return the vertex position in homogeneous screen space\n}\n```\n\n![Picture](/images/blog/metal-render-pipeline-part-3-vertex-fragment-shaders/4.png)\n\n[Image Source 🔗](https://developer.apple.com/documentation/metal/using_a_render_pipeline_to_render_primitives)\n\n---\n\n## Fragment Shader\n\nThe **fragment function** now takes in a **FragmentData** structure.\n\nWe get an **interpolated color** coming in, which we can use to paint the corresponding pixel.\n\n```swift\nfragment half4 basic_fragment_shader(FragmentData IN [[ stage_in ]]){\n    float4 color = IN.color;\n    return half4(color.r, color.g, color.b, color.a);\n}\n```\n\n![Picture](/images/blog/metal-render-pipeline-part-3-vertex-fragment-shaders/5.png)\n\n[Image Source 🔗](https://developer.apple.com/documentation/metal/using_a_render_pipeline_to_render_primitives)\n\n---\n\n## Result\n\n![Picture](/images/blog/metal-render-pipeline-part-3-vertex-fragment-shaders/cover.jpg)\n"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"metal-render-pipeline-part-3-vertex-fragment-shaders"},"buildId":"dySdq6Xb0NnqayZdO7C_6","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>