<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Metal Render Pipeline Part 12: Nested Model Matrices</title><meta name="title" content="Metal Render Pipeline Part 12: Nested Model Matrices"/><meta name="description" content="Using the parent transform to calculate the child model matrix, taking into account the transformation applied to the parent."/><meta property="og:type" content="website"/><meta property="og:url" content="https://z4gon.github.io/blog/metal-render-pipeline-part-12-nested-model-matrices"/><meta property="og:title" content="Metal Render Pipeline Part 12: Nested Model Matrices"/><meta property="og:description" content="Using the parent transform to calculate the child model matrix, taking into account the transformation applied to the parent."/><meta property="og:image" content="https://z4gon.github.io/images/blog/metal-render-pipeline-part-12-nested-model-matrices/cover.jpg"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:url" content="https://z4gon.github.io/blog/metal-render-pipeline-part-12-nested-model-matrices"/><meta property="twitter:title" content="Metal Render Pipeline Part 12: Nested Model Matrices"/><meta property="twitter:description" content="Using the parent transform to calculate the child model matrix, taking into account the transformation applied to the parent."/><meta property="twitter:image" content="https://z4gon.github.io/images/blog/metal-render-pipeline-part-12-nested-model-matrices/cover.jpg"/><link rel="icon" href="https://z4gon.github.io/favicon.ico"/><link rel="canonical" href="https://z4gon.github.io/blog/metal-render-pipeline-part-12-nested-model-matrices"/><meta name="next-head-count" content="17"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/1bfb3b4d6930f464.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1bfb3b4d6930f464.css" data-n-g=""/><link rel="preload" href="/_next/static/css/bb71d252b31868f6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/bb71d252b31868f6.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-38cee4c0e358b1a3.js" defer=""></script><script src="/_next/static/chunks/framework-73b8966a3c579ab0.js" defer=""></script><script src="/_next/static/chunks/main-69a178ab7f70753f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-87bdc82b6a84bda5.js" defer=""></script><script src="/_next/static/chunks/151-f9c9b99fd8f3d05e.js" defer=""></script><script src="/_next/static/chunks/358-df82d8913b69c29e.js" defer=""></script><script src="/_next/static/chunks/770-ce5b54d15e827716.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-5a3d5f8432dd744d.js" defer=""></script><script src="/_next/static/CBTymxIWk04gkq0JwRoiH/_buildManifest.js" defer=""></script><script src="/_next/static/CBTymxIWk04gkq0JwRoiH/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,500;0,700;1,300;1,500&display=swap">@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memQYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWq8tWZ0Pw86hd0Rk5hkaVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memQYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWq8tWZ0Pw86hd0Rk_RkaVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsiH0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjr0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsg-1y4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtE6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWvU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWu06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWt06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuU6FxZCJgg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtE6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWvU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWu06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWt06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuU6FxZCJgg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v35/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="Page_page__0A7TG"><nav class="NavBar_navbar__W8B89"><ul class="NavBar_links__s6P8N"><li><a class="NavBar_titleLink__OtPh0" href="/"><h1>Gonzalo Cumini</h1></a></li><li class="NavBar_secondaryLink__TpgXh"><a href="/"><h1>Portfolio</h1></a></li><li class="NavBar_secondaryLink__TpgXh"><a href="/blog"><h1>Blog</h1></a></li></ul><ul class="NavBar_icons__Q_6kO"><li class="NavBar_icon__MjYq8"><a href="https://linkedin.com/in/gonzacn" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li><li class="NavBar_icon__MjYq8"><a href="https://github.com/z4gon" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li></ul></nav><main class="Container_container__B4HQR Container_narrow__Miio9"><div style="padding-top:3.5em"></div><article><div class="PostHeader_postHeader__aw96i"><h1 class="PostTitle_postTitle__oD_V4">Metal Render Pipeline Part 12: Nested Model Matrices</h1><div class="PostHeader_authorAndDate__tbJVE"><div class="Avatar_avatar__G9F0L"><img src="/images/avatars/z4gon.jpg" alt="Gonzalo Cumini"/><div class="Avatar_name__yGpBe">Gonzalo Cumini</div></div><time class="DateFormatter_dateFormatter__UBCZJ" dateTime="2022-12-30T00:00:00.000Z">December	30, 2022</time></div><video muted="" playsinline="" controls="" class="PostHeader_coverVideo__CTucm"><source src="/videos/blog/metal-render-pipeline-part-12-nested-model-matrices/1.mp4" type="video/mp4"/></video></div><div class="MarkdownContent_markdownContent__TdwXL"><h2 id="source-code">Source Code</h2>
<p><a href="https://github.com/z4gon/metal-render-pipeline">See Project in GitHub 👩‍💻</a></p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.youtube.com/playlist?list=PLEXt1-oJUa4BVgjZt9tK2MhV_DW7PVDsg">Metal Render Pipeline tutorial series by Rick Twohy</a></li>
</ul>
<h2 id="table-of-content">Table of Content</h2>
<ul>
<li><a href="#implementation">Implementation</a></li>
<li><a href="#result">Result</a></li>
</ul>
<hr/>
<h2 id="implementation">Implementation</h2>
<p>The <strong>model matrix</strong> is now located in the <strong>transform</strong> level, and every <strong>lateUpdate</strong>, the transform updates its model matrix.</p>
<p>Each <strong>transform</strong> will check if it has a parent, and will multiply the <strong>parent model matrix</strong> by its <strong>model matrix</strong>, making a new model matrix that takes into account the transformations of the parent.</p>
<pre><div style="color:white;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;font-size:1em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;background:#011627"><code class="language-swift" style="color:#d6deeb;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;font-size:1em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">1</span><span class="token" style="color:rgb(127, 219, 202)">class</span><span> </span><span class="token" style="color:rgb(255, 203, 139)">Transform</span><span> </span><span class="token" style="color:rgb(199, 146, 234)">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">2</span><span>    </span><span class="token" style="color:rgb(127, 219, 202)">...</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">3</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">4</span><span>    </span><span class="token" style="color:rgb(127, 219, 202)">public</span><span> </span><span class="token" style="color:rgb(127, 219, 202)">var</span><span> modelMatrix</span><span class="token" style="color:rgb(199, 146, 234)">:</span><span> float4x4 </span><span class="token" style="color:rgb(127, 219, 202)">=</span><span> matrix_identity_float4x4
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">5</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">6</span><span>    </span><span class="token" style="color:rgb(127, 219, 202)">private</span><span> </span><span class="token" style="color:rgb(127, 219, 202)">var</span><span> _parent</span><span class="token" style="color:rgb(199, 146, 234)">:</span><span> </span><span class="token" style="color:rgb(255, 203, 139)">Transform</span><span class="token" style="color:rgb(127, 219, 202)">?</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">7</span><span>    </span><span class="token" style="color:rgb(127, 219, 202)">public</span><span> </span><span class="token" style="color:rgb(127, 219, 202)">var</span><span> parent</span><span class="token" style="color:rgb(199, 146, 234)">:</span><span> </span><span class="token" style="color:rgb(255, 203, 139)">Transform</span><span class="token" style="color:rgb(127, 219, 202)">?</span><span> </span><span class="token" style="color:rgb(199, 146, 234)">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">8</span><span>        </span><span class="token" style="color:rgb(127, 219, 202)">return</span><span> _parent
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">9</span><span>    </span><span class="token" style="color:rgb(199, 146, 234)">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">10</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">11</span><span>    </span><span class="token" style="color:rgb(127, 219, 202)">public</span><span> </span><span class="token" style="color:rgb(127, 219, 202)">func</span><span> </span><span class="token function-definition" style="color:rgb(130, 170, 255)">setParent</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span class="token omit" style="color:rgb(127, 219, 202)">_</span><span> parent</span><span class="token" style="color:rgb(199, 146, 234)">:</span><span> </span><span class="token" style="color:rgb(255, 203, 139)">Transform</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span class="token" style="color:rgb(199, 146, 234)">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">12</span><span>        _parent </span><span class="token" style="color:rgb(127, 219, 202)">=</span><span> parent
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">13</span><span>    </span><span class="token" style="color:rgb(199, 146, 234)">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">14</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">15</span><span>    </span><span class="token" style="color:rgb(127, 219, 202)">private</span><span> </span><span class="token" style="color:rgb(127, 219, 202)">func</span><span> </span><span class="token function-definition" style="color:rgb(130, 170, 255)">updateModelMatrix</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span> </span><span class="token" style="color:rgb(199, 146, 234)">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">16</span><span>        </span><span class="token" style="color:rgb(127, 219, 202)">var</span><span> result</span><span class="token" style="color:rgb(199, 146, 234)">:</span><span> float4x4 </span><span class="token" style="color:rgb(127, 219, 202)">=</span><span> matrix_identity_float4x4
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">17</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">18</span><span>        result</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span class="token" style="color:rgb(130, 170, 255)">translate</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span>position</span><span class="token" style="color:rgb(199, 146, 234)">:</span><span> position</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">19</span><span>        result</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span class="token" style="color:rgb(130, 170, 255)">scale</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span>scale</span><span class="token" style="color:rgb(199, 146, 234)">:</span><span> scale</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">20</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">21</span><span>        result</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span class="token" style="color:rgb(130, 170, 255)">rotateX</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span>angle</span><span class="token" style="color:rgb(199, 146, 234)">:</span><span> rotation</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span>x</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">22</span><span>        result</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span class="token" style="color:rgb(130, 170, 255)">rotateY</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span>angle</span><span class="token" style="color:rgb(199, 146, 234)">:</span><span> rotation</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span>y</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">23</span><span>        result</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span class="token" style="color:rgb(130, 170, 255)">rotateZ</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span>angle</span><span class="token" style="color:rgb(199, 146, 234)">:</span><span> rotation</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span>z</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">24</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">25</span><span>        </span><span class="token" style="color:rgb(127, 219, 202)">if</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span>_parent </span><span class="token" style="color:rgb(127, 219, 202)">!=</span><span> </span><span class="token nil" style="color:rgb(130, 170, 255)">nil</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span class="token" style="color:rgb(199, 146, 234)">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">26</span><span>            modelMatrix </span><span class="token" style="color:rgb(127, 219, 202)">=</span><span> _parent</span><span class="token" style="color:rgb(127, 219, 202)">!</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span>modelMatrix </span><span class="token" style="color:rgb(127, 219, 202)">*</span><span> result
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">27</span><span>        </span><span class="token" style="color:rgb(199, 146, 234)">}</span><span> </span><span class="token" style="color:rgb(127, 219, 202)">else</span><span> </span><span class="token" style="color:rgb(199, 146, 234)">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">28</span><span>            modelMatrix </span><span class="token" style="color:rgb(127, 219, 202)">=</span><span> result
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">29</span><span>        </span><span class="token" style="color:rgb(199, 146, 234)">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">30</span><span>    </span><span class="token" style="color:rgb(199, 146, 234)">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">31</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">32</span><span>    </span><span class="token" style="color:rgb(99, 119, 119);font-style:italic">// https://docs.unity3d.com/ScriptReference/MonoBehaviour.LateUpdate.html</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">33</span><span>    </span><span class="token" style="color:rgb(99, 119, 119);font-style:italic">// LateUpdate is called after all Update functions have been called</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">34</span><span>    </span><span class="token" style="color:rgb(127, 219, 202)">public</span><span> </span><span class="token" style="color:rgb(127, 219, 202)">func</span><span> </span><span class="token function-definition" style="color:rgb(130, 170, 255)">lateUpdate</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span class="token" style="color:rgb(199, 146, 234)">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">35</span><span>        </span><span class="token" style="color:rgb(127, 219, 202)">if</span><span> </span><span class="token" style="color:rgb(127, 219, 202)">let</span><span> updatableSelf </span><span class="token" style="color:rgb(127, 219, 202)">=</span><span> </span><span class="token" style="color:rgb(127, 219, 202)">self</span><span> </span><span class="token" style="color:rgb(127, 219, 202)">as</span><span class="token" style="color:rgb(127, 219, 202)">?</span><span> </span><span class="token" style="color:rgb(255, 203, 139)">LateUpdatable</span><span> </span><span class="token" style="color:rgb(199, 146, 234)">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">36</span><span>            updatableSelf</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span class="token" style="color:rgb(130, 170, 255)">doLateUpdate</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">37</span><span>        </span><span class="token" style="color:rgb(199, 146, 234)">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">38</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">39</span><span>        </span><span class="token" style="color:rgb(130, 170, 255)">updateModelMatrix</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">40</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">41</span><span>        </span><span class="token" style="color:rgb(127, 219, 202)">for</span><span> child </span><span class="token" style="color:rgb(127, 219, 202)">in</span><span> _children </span><span class="token" style="color:rgb(199, 146, 234)">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">42</span><span>            child</span><span class="token" style="color:rgb(199, 146, 234)">.</span><span class="token" style="color:rgb(130, 170, 255)">lateUpdate</span><span class="token" style="color:rgb(199, 146, 234)">(</span><span class="token" style="color:rgb(199, 146, 234)">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">43</span><span>        </span><span class="token" style="color:rgb(199, 146, 234)">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">44</span><span>    </span><span class="token" style="color:rgb(199, 146, 234)">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:rgb(99, 119, 119);font-style:italic">45</span><span></span><span class="token" style="color:rgb(199, 146, 234)">}</span></code></div></pre>
<hr/>
<h2 id="result">Result</h2>
<p>Now the cube moves along the parent quad.</p>
<p><img src="/images/blog/metal-render-pipeline-part-12-nested-model-matrices/cover.jpg" alt="Picture"/></p></div></article><div style="padding-top:3.5em"></div></main><footer class="Footer_footer__rEL09"><p>©<!-- --> 2023, Gonzalo Cumini</p><ul class="Footer_icons__IyNdc"><li class="Footer_icon__mhtwE"><a href="https://linkedin.com/in/gonzacn" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li><li class="Footer_icon__mhtwE"><a href="https://github.com/z4gon" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li></ul></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"metal-render-pipeline-part-12-nested-model-matrices","date":"2022-12-30T00:00:00.000Z","author":{"name":"Gonzalo Cumini","pictureUrl":"/images/avatars/z4gon.jpg"},"title":"Metal Render Pipeline Part 12: Nested Model Matrices","excerpt":"Using the parent transform to calculate the child model matrix, taking into account the transformation applied to the parent.","coverImageUrl":"/images/blog/metal-render-pipeline-part-12-nested-model-matrices/cover.jpg","coverImageSourceUrl":"","coverVideoUrl":"/videos/blog/metal-render-pipeline-part-12-nested-model-matrices/1.mp4","markdownContent":"\n## Source Code\n\n[See Project in GitHub 👩‍💻](https://github.com/z4gon/metal-render-pipeline)\n\n## References\n\n- [Metal Render Pipeline tutorial series by Rick Twohy](https://www.youtube.com/playlist?list=PLEXt1-oJUa4BVgjZt9tK2MhV_DW7PVDsg)\n\n## Table of Content\n\n- [Implementation](#implementation)\n- [Result](#result)\n\n---\n\n## Implementation\n\nThe **model matrix** is now located in the **transform** level, and every **lateUpdate**, the transform updates its model matrix.\n\nEach **transform** will check if it has a parent, and will multiply the **parent model matrix** by its **model matrix**, making a new model matrix that takes into account the transformations of the parent.\n\n```swift\nclass Transform {\n    ...\n\n    public var modelMatrix: float4x4 = matrix_identity_float4x4\n\n    private var _parent: Transform?\n    public var parent: Transform? {\n        return _parent\n    }\n\n    public func setParent(_ parent: Transform){\n        _parent = parent\n    }\n\n    private func updateModelMatrix() {\n        var result: float4x4 = matrix_identity_float4x4\n\n        result.translate(position: position)\n        result.scale(scale: scale)\n\n        result.rotateX(angle: rotation.x)\n        result.rotateY(angle: rotation.y)\n        result.rotateZ(angle: rotation.z)\n\n        if(_parent != nil){\n            modelMatrix = _parent!.modelMatrix * result\n        } else {\n            modelMatrix = result\n        }\n    }\n\n    // https://docs.unity3d.com/ScriptReference/MonoBehaviour.LateUpdate.html\n    // LateUpdate is called after all Update functions have been called\n    public func lateUpdate(){\n        if let updatableSelf = self as? LateUpdatable {\n            updatableSelf.doLateUpdate()\n        }\n\n        updateModelMatrix()\n\n        for child in _children {\n            child.lateUpdate()\n        }\n    }\n}\n```\n\n---\n\n## Result\n\nNow the cube moves along the parent quad.\n\n![Picture](/images/blog/metal-render-pipeline-part-12-nested-model-matrices/cover.jpg)\n"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"metal-render-pipeline-part-12-nested-model-matrices"},"buildId":"CBTymxIWk04gkq0JwRoiH","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>