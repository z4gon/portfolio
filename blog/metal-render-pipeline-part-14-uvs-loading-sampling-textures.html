<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Metal Render Pipeline Part 14: UVs, Loading and Sampling Textures</title><meta name="title" content="Metal Render Pipeline Part 14: UVs, Loading and Sampling Textures"/><meta name="description" content="Defining the UV coordinates in the vertices of the mesh, and also in the GPU structs used in the Vertex and Fragment functions. Initializing MTLTextures and MTLSamplerStates to handle texture sampling. Passing textures and samplers to the GPU from the material. Accessing the texture and sampler in the corresponding memory blocks in the GPU and sampling the texels using the UV coordinates in the fragment shader function."/><meta property="og:type" content="website"/><meta property="og:url" content="https://z4gon.github.io/blog/metal-render-pipeline-part-14-uvs-loading-sampling-textures"/><meta property="og:title" content="Metal Render Pipeline Part 14: UVs, Loading and Sampling Textures"/><meta property="og:description" content="Defining the UV coordinates in the vertices of the mesh, and also in the GPU structs used in the Vertex and Fragment functions. Initializing MTLTextures and MTLSamplerStates to handle texture sampling. Passing textures and samplers to the GPU from the material. Accessing the texture and sampler in the corresponding memory blocks in the GPU and sampling the texels using the UV coordinates in the fragment shader function."/><meta property="og:image" content="https://z4gon.github.io/images/blog/metal-render-pipeline-part-14-uvs-loading-sampling-textures/cover.jpg"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:url" content="https://z4gon.github.io/blog/metal-render-pipeline-part-14-uvs-loading-sampling-textures"/><meta property="twitter:title" content="Metal Render Pipeline Part 14: UVs, Loading and Sampling Textures"/><meta property="twitter:description" content="Defining the UV coordinates in the vertices of the mesh, and also in the GPU structs used in the Vertex and Fragment functions. Initializing MTLTextures and MTLSamplerStates to handle texture sampling. Passing textures and samplers to the GPU from the material. Accessing the texture and sampler in the corresponding memory blocks in the GPU and sampling the texels using the UV coordinates in the fragment shader function."/><meta property="twitter:image" content="https://z4gon.github.io/images/blog/metal-render-pipeline-part-14-uvs-loading-sampling-textures/cover.jpg"/><link rel="icon" href="https://z4gon.github.io/favicon.ico"/><link rel="canonical" href="https://z4gon.github.io/blog/metal-render-pipeline-part-14-uvs-loading-sampling-textures"/><meta name="next-head-count" content="17"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/1bfb3b4d6930f464.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1bfb3b4d6930f464.css" data-n-g=""/><link rel="preload" href="/_next/static/css/2e3bbe6ac04cb541.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2e3bbe6ac04cb541.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-38cee4c0e358b1a3.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-010ff0b6bbe5ac8f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-a7128038526bd4a3.js" defer=""></script><script src="/_next/static/chunks/151-c7a4603d5dcabdf0.js" defer=""></script><script src="/_next/static/chunks/358-14c60bb94e9d94b9.js" defer=""></script><script src="/_next/static/chunks/473-69ba6a3172c39601.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-b3da1efa42a89c77.js" defer=""></script><script src="/_next/static/pEeFLw9hz0jUAeUnE59ff/_buildManifest.js" defer=""></script><script src="/_next/static/pEeFLw9hz0jUAeUnE59ff/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,500;0,700;1,300;1,500&display=swap">@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memQYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWq8tWZ0Pw86hd0Rk5hkaVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memQYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWq8tWZ0Pw86hd0Rk_RkaVQ.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsiH0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjr0C4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsg-1y4k.woff) format('woff')}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtE6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWvU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWu06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWt06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuU6FxZCJgg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtE6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWvU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtU6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWu06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWtk6FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWt06FxZCJgvAQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:italic;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memtYaGs126MiZpBA-UFUIcVXSCEkx2cmqvXlWqWuU6FxZCJgg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:500;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSKmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSumu0SC55K5gw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSOmu0SC55K5gw.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSymu0SC55K5gw.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS2mu0SC55K5gw.woff2) format('woff2');unicode-range:U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSCmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTSGmu0SC55K5gw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/opensans/v34/memvYaGs126MiZpBA-UvWbX2vVnXBbObj2OVTS-mu0SC55I.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="Page_page__0A7TG Blog_blog__RrqTL"><nav class="NavBar_navbar__W8B89"><ul class="NavBar_links__s6P8N"><li><a class="NavBar_titleLink__OtPh0" href="/"><h1>Gonzalo Cumini</h1></a></li><li class="NavBar_secondaryLink__TpgXh"><a href="/"><h1>Portfolio</h1></a></li><li class="NavBar_secondaryLink__TpgXh"><a href="/blog"><h1>Blog</h1></a></li></ul><ul class="NavBar_icons__Q_6kO"><li class="NavBar_icon__MjYq8"><a href="https://linkedin.com/in/gonzacn" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li><li class="NavBar_icon__MjYq8"><a href="https://github.com/z4gon" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li></ul></nav><main class="Container_container__B4HQR Container_narrow__Miio9"><div style="padding-top:3.5em"></div><article><div class="PostHeader_postHeader__aw96i"><h1 class="PostTitle_postTitle__oD_V4">Metal Render Pipeline Part 14: UVs, Loading and Sampling Textures</h1><div class="PostHeader_authorAndDate__tbJVE"><div class="Avatar_avatar__G9F0L"><img src="/images/avatars/z4gon.jpg" alt="Gonzalo Cumini"/><div class="Avatar_name__yGpBe">Gonzalo Cumini</div></div><time class="DateFormatter_dateFormatter__UBCZJ" dateTime="2023-01-01T01:00:00.000Z">January	1, 2023</time></div><video muted="" playsinline="" controls="" class="PostHeader_coverVideo__CTucm"><source src="/videos/blog/metal-render-pipeline-part-14-uvs-loading-sampling-textures/1.mp4" type="video/mp4"/></video></div><div class="MarkdownContent_markdownContent__TdwXL"><h2 id="source-code">Source Code</h2>
<p><a href="https://github.com/z4gon/metal-render-pipeline">See Project in GitHub üë©‚Äçüíª</a></p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.youtube.com/playlist?list=PLEXt1-oJUa4BVgjZt9tK2MhV_DW7PVDsg">Metal Render Pipeline tutorial series by Rick Twohy</a></li>
<li><a href="https://unsplash.com/photos/cZveUvrezvY">Mona Lisa Texture</a></li>
</ul>
<h2 id="table-of-content">Table of Content</h2>
<ul>
<li><a href="#vertex">Vertex</a></li>
<li><a href="#mesh">Mesh</a></li>
<li><a href="#basic-uvs-shader">Basic UVs Shader</a></li>
<li><a href="#texture">Texture</a></li>
<li><a href="#sampler">Sampler</a></li>
<li><a href="#material">Material</a></li>
<li><a href="#shader">Shader</a></li>
<li><a href="#result">Result</a></li>
</ul>
<hr/>
<h2 id="vertex">Vertex</h2>
<p>We need to update the class that represents the <strong>vertices</strong> in the <strong>mesh</strong> by adding a new <strong>float2</strong> to represent the <strong>uv coordinates</strong>.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">struct</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">Vertex</span><span class="hljs-class">: </span><span class="hljs-class" style="color:#880000;font-weight:bold">sizeable</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>    </span><span style="font-weight:bold">var</span><span> position: float3
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span style="font-weight:bold">var</span><span> color: float4
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>    </span><span style="font-weight:bold">var</span><span> uv: float2
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>    </span><span class="hljs-function" style="font-weight:bold">init</span><span class="hljs-function">(
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="hljs-function">        </span><span class="hljs-function hljs-params">position</span><span class="hljs-function">: float3,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class="hljs-function">        </span><span class="hljs-function hljs-params">color</span><span class="hljs-function">: float4 </span><span class="hljs-function hljs-operator">=</span><span class="hljs-function"> float4(repeating: </span><span class="hljs-function" style="color:#880000">0</span><span class="hljs-function">),
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class="hljs-function">        </span><span class="hljs-function hljs-params">uv</span><span class="hljs-function">: float2 </span><span class="hljs-function hljs-operator">=</span><span class="hljs-function"> float2(repeating: </span><span class="hljs-function" style="color:#880000">0</span><span class="hljs-function">)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class="hljs-function">    )</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>        </span><span style="font-weight:bold">self</span><span>.position </span><span class="hljs-operator">=</span><span> position
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span>        </span><span style="font-weight:bold">self</span><span>.color </span><span class="hljs-operator">=</span><span> color
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span><span>        </span><span style="font-weight:bold">self</span><span>.uv </span><span class="hljs-operator">=</span><span> uv
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span>}</code></div></pre>
<p>Similarly, we also need to update the <strong>MTLVertexDescriptor</strong>.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span style="font-weight:bold">public</span><span> </span><span class="hljs-class" style="font-weight:bold">struct</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">BasicVertexDescriptor</span><span class="hljs-class"> : </span><span class="hljs-class" style="color:#880000;font-weight:bold">VertexDescriptor</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>    </span><span class="hljs-operator">...</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>    </span><span class="hljs-function" style="font-weight:bold">init</span><span class="hljs-function">()</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>        </span><span class="hljs-operator">...</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>        </span><span style="color:#888888">// uv</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span>        vertexDescriptor.attributes[</span><span style="color:#880000">2</span><span>].format </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MTLVertexFormat</span><span>.float2
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>        vertexDescriptor.attributes[</span><span style="color:#880000">2</span><span>].bufferIndex </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">0</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span><span>        vertexDescriptor.attributes[</span><span style="color:#880000">2</span><span>].offset </span><span class="hljs-operator">=</span><span> float3.size </span><span class="hljs-operator">+</span><span> float4.size
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span>        </span><span class="hljs-operator">...</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span>}</code></div></pre>
<p>Finally, we also need to update the <strong>VertexData</strong> and <strong>FragmentData</strong> structs in the <strong>GPU</strong> side, and update the <strong>basic_vertex_shader</strong> to pass along the <strong>uvs</strong> to the fragments.</p>
<h3 id="structs">Structs</h3>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-c" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">struct</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">VertexData</span><span class="hljs-class"> {</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>    float3 position [[ attribute(</span><span style="color:#880000">0</span><span>) ]];
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    float4 color [[ attribute(</span><span style="color:#880000">1</span><span>) ]];
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>    float2 uv [[ attribute(</span><span style="color:#880000">2</span><span>) ]];
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span>};
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span></span><span class="hljs-class" style="font-weight:bold">struct</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">FragmentData</span><span class="hljs-class"> {</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span>    </span><span style="color:#888888">// use position attribute to prevent interpolation of the value</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span>    float4 position [[ position ]];
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>    float4 color;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span>    float2 uv;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span>    </span><span style="font-weight:bold">float</span><span> time;
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>};</code></div></pre>
<h3 id="vertex-shader-function">Vertex Shader Function</h3>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-c" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-function">vertex FragmentData </span><span class="hljs-function" style="color:#880000;font-weight:bold">basic_vertex_shader</span><span class="hljs-function hljs-params">(
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class="hljs-function hljs-params">  </span><span class="hljs-function hljs-params" style="color:#888888">// metal can infer the data because we are describing it using the vertex descriptor</span><span class="hljs-function hljs-params">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class="hljs-function hljs-params">  </span><span class="hljs-function hljs-params" style="font-weight:bold">const</span><span class="hljs-function hljs-params"> VertexData IN [[ stage_in ]],
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="hljs-function hljs-params">  constant ModelConstants &amp;modelConstants [[ buffer(</span><span class="hljs-function hljs-params" style="color:#880000">1</span><span class="hljs-function hljs-params">) ]],
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="hljs-function hljs-params">  constant SceneConstants &amp;sceneConstants [[ buffer(</span><span class="hljs-function hljs-params" style="color:#880000">2</span><span class="hljs-function hljs-params">) ]]
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="hljs-function hljs-params">)</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">7</span>    FragmentData OUT;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">8</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">9</span>    ...
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">11</span>    OUT.uv = IN.uv;
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">12</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">13</span>    ...
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">14</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">15</span><span>    </span><span style="font-weight:bold">return</span><span> OUT;
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">16</span>}</code></div></pre>
<hr/>
<h2 id="mesh">Mesh</h2>
<p>We update the Quad mesh to have uv coordinates.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">QuadMesh</span><span class="hljs-class"> : </span><span class="hljs-class" style="color:#880000;font-weight:bold">Mesh</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>    </span><span style="font-weight:bold">override</span><span> </span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">createMesh</span><span class="hljs-function">()</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>        vertices </span><span class="hljs-operator">=</span><span> [
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>            </span><span style="color:#880000">Vertex</span><span>(position: float3( </span><span style="color:#880000">0.5</span><span>, </span><span style="color:#880000">0.5</span><span>,</span><span style="color:#880000">0</span><span>), uv: float2(</span><span style="color:#880000">1</span><span>,</span><span style="color:#880000">0</span><span>)), </span><span style="color:#888888">//Top Right</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>            </span><span style="color:#880000">Vertex</span><span>(position: float3(</span><span class="hljs-operator">-</span><span style="color:#880000">0.5</span><span>, </span><span style="color:#880000">0.5</span><span>,</span><span style="color:#880000">0</span><span>), uv: float2(</span><span style="color:#880000">0</span><span>,</span><span style="color:#880000">0</span><span>)), </span><span style="color:#888888">//Top Left</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>            </span><span style="color:#880000">Vertex</span><span>(position: float3(</span><span class="hljs-operator">-</span><span style="color:#880000">0.5</span><span>,</span><span class="hljs-operator">-</span><span style="color:#880000">0.5</span><span>,</span><span style="color:#880000">0</span><span>), uv: float2(</span><span style="color:#880000">0</span><span>,</span><span style="color:#880000">1</span><span>)), </span><span style="color:#888888">//Bottom Left</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>            </span><span style="color:#880000">Vertex</span><span>(position: float3( </span><span style="color:#880000">0.5</span><span>,</span><span class="hljs-operator">-</span><span style="color:#880000">0.5</span><span>,</span><span style="color:#880000">0</span><span>), uv: float2(</span><span style="color:#880000">1</span><span>,</span><span style="color:#880000">1</span><span>))  </span><span style="color:#888888">//Bottom Right</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span>        ]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span><span>        indices </span><span class="hljs-operator">=</span><span> [
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>            </span><span style="color:#880000">0</span><span>,</span><span style="color:#880000">1</span><span>,</span><span style="color:#880000">2</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span>            </span><span style="color:#880000">0</span><span>,</span><span style="color:#880000">2</span><span>,</span><span style="color:#880000">3</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>        ]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span>}</code></div></pre>
<hr/>
<h2 id="basic-uvs-shader">Basic UVs Shader</h2>
<p>Right now we can define a <strong>simple fragment shader</strong> to display the <strong>uv coordinates</strong> <strong>colors</strong>, and also animate it using the <strong>global game time</strong>.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-c" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-function">fragment half4 </span><span class="hljs-function" style="color:#880000;font-weight:bold">uvs_fragment_shader</span><span class="hljs-function hljs-params">(
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class="hljs-function hljs-params">    </span><span class="hljs-function hljs-params" style="font-weight:bold">const</span><span class="hljs-function hljs-params"> FragmentData IN [[ stage_in ]]
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span class="hljs-function hljs-params">)</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>    </span><span style="font-weight:bold">return</span><span> half4(
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>        </span><span style="color:#397300">sin</span><span>(IN.uv.x + IN.time),
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>        </span><span style="color:#397300">sin</span><span>(IN.uv.y + IN.time),
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>        </span><span style="color:#880000">0</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span>        </span><span style="color:#880000">1</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span>    );
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>}</code></div></pre>
<h3 id="uvs-gradient">UVs Gradient</h3>
<p><img src="/images/blog/metal-render-pipeline-part-14-uvs-loading-sampling-textures/1.jpg" alt="Picture"/></p>
<hr/>
<h2 id="texture">Texture</h2>
<p>We will create a cache to store built in textures, using <strong>MTLTexture</strong> and <strong>MTKTextureLoader</strong>.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">TextureLoader</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>    </span><span style="font-weight:bold">private</span><span> </span><span style="font-weight:bold">var</span><span> _name: </span><span style="color:#880000">String</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span style="font-weight:bold">private</span><span> </span><span style="font-weight:bold">var</span><span> _fileExtension: </span><span style="color:#880000">String</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>    </span><span style="font-weight:bold">private</span><span> </span><span style="font-weight:bold">var</span><span> _origin: </span><span style="color:#880000">MTKTextureLoader</span><span>.</span><span style="color:#880000">Origin</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>    </span><span class="hljs-operator">...</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span>    </span><span style="font-weight:bold">public</span><span> </span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">load</span><span class="hljs-function">()</span><span>-&gt;</span><span style="color:#880000">MTLTexture</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>        </span><span style="font-weight:bold">var</span><span> result: </span><span style="color:#880000">MTLTexture</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>        </span><span style="font-weight:bold">if</span><span> </span><span style="font-weight:bold">let</span><span> url </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">Bundle</span><span>.main.url(forResource: _name, withExtension: _fileExtension) {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span><span>            </span><span style="font-weight:bold">let</span><span> loader </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MTKTextureLoader</span><span>(device: </span><span style="color:#880000">Engine</span><span>.device)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span><span>            </span><span style="font-weight:bold">let</span><span> options: [</span><span style="color:#880000">MTKTextureLoader</span><span>.</span><span style="color:#880000">Option</span><span>: </span><span style="font-weight:bold">Any</span><span>] </span><span class="hljs-operator">=</span><span> [</span><span style="color:#880000">MTKTextureLoader</span><span>.</span><span style="color:#880000">Option</span><span>.origin : _origin]
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">16</span><span>            </span><span style="font-weight:bold">do</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">17</span><span>                result </span><span class="hljs-operator">=</span><span> </span><span style="font-weight:bold">try</span><span> loader.newTexture(URL: url, options: options)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">18</span><span>                result.label </span><span class="hljs-operator">=</span><span> _name
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">19</span><span>        </span><span class="hljs-operator">...</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">20</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">21</span><span>        </span><span style="font-weight:bold">return</span><span> result
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">22</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">23</span>}</code></div></pre>
<hr/>
<h2 id="sampler">Sampler</h2>
<p>Similarly, we will keep a cache of <strong>MTLSamplerState</strong> to use when sampling the textures.</p>
<p><strong>Linear</strong> means the <strong>algorithm</strong> that will be use when sampling textures, when the object is <strong>minified</strong> or <strong>magnified</strong> on screen.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">LinearSamplerState</span><span class="hljs-class"> : </span><span class="hljs-class" style="color:#880000;font-weight:bold">SamplerState</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span style="font-weight:bold">override</span><span> </span><span class="hljs-function" style="font-weight:bold">init</span><span class="hljs-function">()</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>        </span><span style="font-weight:bold">super</span><span>.</span><span style="font-weight:bold">init</span><span>()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>        </span><span style="font-weight:bold">let</span><span> samplerDescriptor </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MTLSamplerDescriptor</span><span>()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span>        samplerDescriptor.minFilter </span><span class="hljs-operator">=</span><span> .linear
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>        samplerDescriptor.magFilter </span><span class="hljs-operator">=</span><span> .linear
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>        samplerState </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">Engine</span><span>.device.makeSamplerState(descriptor: samplerDescriptor)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>}</code></div></pre>
<hr/>
<h2 id="material">Material</h2>
<p>The <strong>material</strong> will be in charge of passing the <strong>Texture</strong> and the <strong>SamplerState</strong> to the <strong>GPU</strong> before rendering.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-class" style="font-weight:bold">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#880000;font-weight:bold">TextureSampleMaterial</span><span class="hljs-class">: </span><span class="hljs-class" style="color:#880000;font-weight:bold">Material</span><span class="hljs-class"> </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span style="font-weight:bold">private</span><span> </span><span style="font-weight:bold">var</span><span> _textureType: </span><span style="color:#880000">BuiltInTexture</span><span>!
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>    </span><span class="hljs-function" style="font-weight:bold">init</span><span class="hljs-function">(</span><span class="hljs-function" style="font-weight:bold">_</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">textureType</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">BuiltInTexture</span><span class="hljs-function">)</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>        </span><span style="font-weight:bold">super</span><span>.</span><span style="font-weight:bold">init</span><span>()
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>        fragmentFunctionName </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">FragmentFunctionNames</span><span>.</span><span style="color:#880000">TextureSample</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span>        setTextureType(textureType)
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>    </span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">setTextureType</span><span class="hljs-function">(</span><span class="hljs-function" style="font-weight:bold">_</span><span class="hljs-function"> </span><span class="hljs-function hljs-params">textureType</span><span class="hljs-function">: </span><span class="hljs-function" style="color:#880000">BuiltInTexture</span><span class="hljs-function">)</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span>        _textureType </span><span class="hljs-operator">=</span><span> textureType
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span><span>    </span><span style="font-weight:bold">override</span><span> </span><span class="hljs-function" style="font-weight:bold">func</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#880000;font-weight:bold">setGpuValues</span><span class="hljs-function">()</span><span> {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">16</span><span>        </span><span style="color:#880000">Graphics</span><span>.renderCommandEncoder.setFragmentSamplerState(</span><span style="color:#880000">SamplerStateCache</span><span>.get(.</span><span style="color:#880000">Linear</span><span>), index: </span><span style="color:#880000">0</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">17</span><span>        </span><span style="color:#880000">Graphics</span><span>.renderCommandEncoder.setFragmentTexture(</span><span style="color:#880000">TextureCache</span><span>.get(_textureType), index: </span><span style="color:#880000">0</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">18</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">19</span>}</code></div></pre>
<p>The <strong>Game Object</strong> initializes the <strong>MeshRenderer</strong> with the corresponding <strong>Material</strong> and <strong>Texture</strong>.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-swift" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span style="font-weight:bold">let</span><span> mesh </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">MeshCache</span><span>.get(.</span><span style="color:#880000">Quad</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span></span><span style="font-weight:bold">let</span><span> material </span><span class="hljs-operator">=</span><span> </span><span style="color:#880000">TextureSampleMaterial</span><span>(.</span><span style="color:#880000">MonaLisa</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span></span><span style="font-weight:bold">self</span><span>.addComponent(</span><span style="color:#880000">MeshRenderer</span><span>(mesh: mesh, material: material))</span></code></div></pre>
<hr/>
<h2 id="shader">Shader</h2>
<p>In the <strong>Metal Shader</strong> code, we will access the <strong>Texture</strong> and <strong>SamplerState</strong> from the corresponding <strong>blocks of memory</strong>.</p>
<p><strong>sampler(0)</strong> and <strong>texture(0)</strong> mean that we will access the desired elements at the specified indexes.</p>
<pre><div style="display:block;overflow-x:auto;padding:0.5em;background:#F0F0F0;color:#444"><code class="language-c" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span class="hljs-function">fragment half4 </span><span class="hljs-function" style="color:#880000;font-weight:bold">texture_sample_fragment_shader</span><span class="hljs-function hljs-params">(
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span><span class="hljs-function hljs-params">    </span><span class="hljs-function hljs-params" style="font-weight:bold">const</span><span class="hljs-function hljs-params"> FragmentData IN [[ stage_in ]],
</span><span class="hljs-function hljs-params"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span><span class="hljs-function hljs-params">    </span><span class="hljs-function hljs-params" style="color:#888888">// sampler and texture2d coming in their corresponding memory blocks</span><span class="hljs-function hljs-params">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="hljs-function hljs-params">    sampler sampler2d [[ sampler(</span><span class="hljs-function hljs-params" style="color:#880000">0</span><span class="hljs-function hljs-params">) ]],
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="hljs-function hljs-params">    texture2d&lt;</span><span class="hljs-function hljs-params" style="font-weight:bold">float</span><span class="hljs-function hljs-params">&gt; texture [[ texture(</span><span class="hljs-function hljs-params" style="color:#880000">0</span><span class="hljs-function hljs-params">) ]]
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="hljs-function hljs-params">)</span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">8</span>    float4 color = texture.sample(sampler2d, IN.uv);
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>    </span><span style="font-weight:bold">return</span><span> half4(color.r, color.g, color.b, color.a);
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">10</span>}</code></div></pre>
<hr/>
<h2 id="result">Result</h2>
<p>The Quad now renders the texture using the UV texture coordinates.</p>
<p><img src="/images/blog/metal-render-pipeline-part-14-uvs-loading-sampling-textures/cover.jpg" alt="Picture"/></p></div></article><div style="padding-top:3.5em"></div></main><footer class="Footer_footer__rEL09"><p>¬©<!-- --> 2023, Gonzalo Cumini</p><ul class="Footer_icons__IyNdc"><li class="Footer_icon__mhtwE"><a href="https://linkedin.com/in/gonzacn" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li><li class="Footer_icon__mhtwE"><a href="https://github.com/z4gon" rel="noopener noreferrer" target="_blank"><svg class="IconLink_iconSvg__kq2nE" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li></ul></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"metal-render-pipeline-part-14-uvs-loading-sampling-textures","date":"2023-01-01T01:00:00.000Z","author":{"name":"Gonzalo Cumini","pictureUrl":"/images/avatars/z4gon.jpg"},"title":"Metal Render Pipeline Part 14: UVs, Loading and Sampling Textures","excerpt":"Defining the UV coordinates in the vertices of the mesh, and also in the GPU structs used in the Vertex and Fragment functions. Initializing MTLTextures and MTLSamplerStates to handle texture sampling. Passing textures and samplers to the GPU from the material. Accessing the texture and sampler in the corresponding memory blocks in the GPU and sampling the texels using the UV coordinates in the fragment shader function.","coverImageUrl":"/images/blog/metal-render-pipeline-part-14-uvs-loading-sampling-textures/cover.jpg","coverImageSourceUrl":"","coverVideoUrl":"/videos/blog/metal-render-pipeline-part-14-uvs-loading-sampling-textures/1.mp4","contentMarkdown":"\n## Source Code\n\n[See Project in GitHub üë©‚Äçüíª](https://github.com/z4gon/metal-render-pipeline)\n\n## References\n\n-   [Metal Render Pipeline tutorial series by Rick Twohy](https://www.youtube.com/playlist?list=PLEXt1-oJUa4BVgjZt9tK2MhV_DW7PVDsg)\n-   [Mona Lisa Texture](https://unsplash.com/photos/cZveUvrezvY)\n\n## Table of Content\n\n-   [Vertex](#vertex)\n-   [Mesh](#mesh)\n-   [Basic UVs Shader](#basic-uvs-shader)\n-   [Texture](#texture)\n-   [Sampler](#sampler)\n-   [Material](#material)\n-   [Shader](#shader)\n-   [Result](#result)\n\n---\n\n## Vertex\n\nWe need to update the class that represents the **vertices** in the **mesh** by adding a new **float2** to represent the **uv coordinates**.\n\n```swift\nstruct Vertex: sizeable{\n    var position: float3\n    var color: float4\n    var uv: float2\n\n    init(\n        position: float3,\n        color: float4 = float4(repeating: 0),\n        uv: float2 = float2(repeating: 0)\n    ) {\n        self.position = position\n        self.color = color\n        self.uv = uv\n    }\n}\n```\n\nSimilarly, we also need to update the **MTLVertexDescriptor**.\n\n```swift\npublic struct BasicVertexDescriptor : VertexDescriptor{\n    ...\n\n    init(){\n        ...\n\n        // uv\n        vertexDescriptor.attributes[2].format = MTLVertexFormat.float2\n        vertexDescriptor.attributes[2].bufferIndex = 0\n        vertexDescriptor.attributes[2].offset = float3.size + float4.size\n\n        ...\n    }\n}\n```\n\nFinally, we also need to update the **VertexData** and **FragmentData** structs in the **GPU** side, and update the **basic_vertex_shader** to pass along the **uvs** to the fragments.\n\n### Structs\n\n```c\nstruct VertexData {\n    float3 position [[ attribute(0) ]];\n    float4 color [[ attribute(1) ]];\n    float2 uv [[ attribute(2) ]];\n};\n\nstruct FragmentData {\n    // use position attribute to prevent interpolation of the value\n    float4 position [[ position ]];\n    float4 color;\n    float2 uv;\n    float time;\n};\n```\n\n### Vertex Shader Function\n\n```c\nvertex FragmentData basic_vertex_shader(\n  // metal can infer the data because we are describing it using the vertex descriptor\n  const VertexData IN [[ stage_in ]],\n  constant ModelConstants \u0026modelConstants [[ buffer(1) ]],\n  constant SceneConstants \u0026sceneConstants [[ buffer(2) ]]\n){\n    FragmentData OUT;\n\n    ...\n\n    OUT.uv = IN.uv;\n\n    ...\n\n    return OUT;\n}\n```\n\n---\n\n## Mesh\n\nWe update the Quad mesh to have uv coordinates.\n\n```swift\nclass QuadMesh : Mesh{\n    override func createMesh() {\n        vertices = [\n            Vertex(position: float3( 0.5, 0.5,0), uv: float2(1,0)), //Top Right\n            Vertex(position: float3(-0.5, 0.5,0), uv: float2(0,0)), //Top Left\n            Vertex(position: float3(-0.5,-0.5,0), uv: float2(0,1)), //Bottom Left\n            Vertex(position: float3( 0.5,-0.5,0), uv: float2(1,1))  //Bottom Right\n        ]\n\n        indices = [\n            0,1,2,\n            0,2,3\n        ]\n    }\n}\n```\n\n---\n\n## Basic UVs Shader\n\nRight now we can define a **simple fragment shader** to display the **uv coordinates** **colors**, and also animate it using the **global game time**.\n\n```c\nfragment half4 uvs_fragment_shader(\n    const FragmentData IN [[ stage_in ]]\n){\n    return half4(\n        sin(IN.uv.x + IN.time),\n        sin(IN.uv.y + IN.time),\n        0,\n        1\n    );\n}\n```\n\n### UVs Gradient\n\n![Picture](/images/blog/metal-render-pipeline-part-14-uvs-loading-sampling-textures/1.jpg)\n\n---\n\n## Texture\n\nWe will create a cache to store built in textures, using **MTLTexture** and **MTKTextureLoader**.\n\n```swift\nclass TextureLoader {\n    private var _name: String!\n    private var _fileExtension: String!\n    private var _origin: MTKTextureLoader.Origin\n\n    ...\n\n    public func load()-\u003eMTLTexture {\n        var result: MTLTexture!\n\n        if let url = Bundle.main.url(forResource: _name, withExtension: _fileExtension) {\n\n            let loader = MTKTextureLoader(device: Engine.device)\n            let options: [MTKTextureLoader.Option: Any] = [MTKTextureLoader.Option.origin : _origin]\n\n            do {\n                result = try loader.newTexture(URL: url, options: options)\n                result.label = _name\n        ...\n\n        return result\n    }\n}\n```\n\n---\n\n## Sampler\n\nSimilarly, we will keep a cache of **MTLSamplerState** to use when sampling the textures.\n\n**Linear** means the **algorithm** that will be use when sampling textures, when the object is **minified** or **magnified** on screen.\n\n```swift\nclass LinearSamplerState : SamplerState {\n\n    override init() {\n        super.init()\n\n        let samplerDescriptor = MTLSamplerDescriptor()\n\n        samplerDescriptor.minFilter = .linear\n        samplerDescriptor.magFilter = .linear\n\n        samplerState = Engine.device.makeSamplerState(descriptor: samplerDescriptor)\n    }\n}\n```\n\n---\n\n## Material\n\nThe **material** will be in charge of passing the **Texture** and the **SamplerState** to the **GPU** before rendering.\n\n```swift\nclass TextureSampleMaterial: Material {\n\n    private var _textureType: BuiltInTexture!\n\n    init(_ textureType: BuiltInTexture) {\n        super.init()\n        fragmentFunctionName = FragmentFunctionNames.TextureSample\n        setTextureType(textureType)\n    }\n\n    func setTextureType(_ textureType: BuiltInTexture) {\n        _textureType = textureType\n    }\n\n    override func setGpuValues() {\n        Graphics.renderCommandEncoder.setFragmentSamplerState(SamplerStateCache.get(.Linear), index: 0)\n        Graphics.renderCommandEncoder.setFragmentTexture(TextureCache.get(_textureType), index: 0)\n    }\n}\n```\n\nThe **Game Object** initializes the **MeshRenderer** with the corresponding **Material** and **Texture**.\n\n```swift\nlet mesh = MeshCache.get(.Quad)\nlet material = TextureSampleMaterial(.MonaLisa)\n\nself.addComponent(MeshRenderer(mesh: mesh, material: material))\n```\n\n---\n\n## Shader\n\nIn the **Metal Shader** code, we will access the **Texture** and **SamplerState** from the corresponding **blocks of memory**.\n\n**sampler(0)** and **texture(0)** mean that we will access the desired elements at the specified indexes.\n\n```c\nfragment half4 texture_sample_fragment_shader(\n    const FragmentData IN [[ stage_in ]],\n\n    // sampler and texture2d coming in their corresponding memory blocks\n    sampler sampler2d [[ sampler(0) ]],\n    texture2d\u003cfloat\u003e texture [[ texture(0) ]]\n){\n    float4 color = texture.sample(sampler2d, IN.uv);\n    return half4(color.r, color.g, color.b, color.a);\n}\n```\n\n---\n\n## Result\n\nThe Quad now renders the texture using the UV texture coordinates.\n\n![Picture](/images/blog/metal-render-pipeline-part-14-uvs-loading-sampling-textures/cover.jpg)\n"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"metal-render-pipeline-part-14-uvs-loading-sampling-textures"},"buildId":"pEeFLw9hz0jUAeUnE59ff","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>